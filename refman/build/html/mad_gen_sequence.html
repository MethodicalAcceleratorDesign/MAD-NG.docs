<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Sequences &mdash; MAD-NG Reference Manual 0.9.6 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="MTables" href="mad_gen_mtable.html" />
    <link rel="prev" title="Elements" href="mad_gen_elements.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            MAD-NG Reference Manual
          </a>
              <div class="version">
                0.9.6
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Part I:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="mad_gen_index.html">LANGUAGE</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="mad_gen_intro.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="mad_gen_script.html">Scripting</a></li>
<li class="toctree-l2"><a class="reference internal" href="mad_gen_object.html">Objects</a></li>
<li class="toctree-l2"><a class="reference internal" href="mad_gen_beam.html">Beams</a></li>
<li class="toctree-l2"><a class="reference internal" href="mad_gen_beta0.html">Beta0 Blocks</a></li>
<li class="toctree-l2"><a class="reference internal" href="mad_gen_elements.html">Elements</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Sequences</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#attributes">Attributes</a></li>
<li class="toctree-l3"><a class="reference internal" href="#methods">Methods</a></li>
<li class="toctree-l3"><a class="reference internal" href="#metamethods">Metamethods</a></li>
<li class="toctree-l3"><a class="reference internal" href="#sequences-creation">Sequences creation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#element-positions">Element positions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#element-selections">Element selections</a></li>
<li class="toctree-l3"><a class="reference internal" href="#indexes-names-and-counts">Indexes, names and counts</a></li>
<li class="toctree-l3"><a class="reference internal" href="#iterators-and-ranges">Iterators and ranges</a></li>
<li class="toctree-l3"><a class="reference internal" href="#examples">Examples</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#fodo-cell">FODO cell</a></li>
<li class="toctree-l4"><a class="reference internal" href="#sps-compact-description">SPS compact description</a></li>
<li class="toctree-l4"><a class="reference internal" href="#installing-elements-i">Installing elements I</a></li>
<li class="toctree-l4"><a class="reference internal" href="#installing-elements-ii">Installing elements II</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="mad_gen_mtable.html">MTables</a></li>
<li class="toctree-l2"><a class="reference internal" href="mad_gen_madx.html">MADX</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Part II:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="mad_cmd_index.html">ELEMENTS &amp; COMMANDS</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Part III:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="mad_phy_index.html">PHYSICS</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Part IV:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="mad_mod_index.html">MODULES</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Part V:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="mad_prg_index.html">PROGRAMMING</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">MAD-NG Reference Manual</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="mad_gen_index.html">LANGUAGE</a></li>
      <li class="breadcrumb-item active">Sequences</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/mad_gen_sequence.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul><div class="rst-breadcrumbs-buttons" role="navigation" aria-label="Sequential page navigation">
        <a href="mad_gen_elements.html" class="btn btn-neutral float-left" title="Elements" accesskey="p"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="mad_gen_mtable.html" class="btn btn-neutral float-right" title="MTables" accesskey="n">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
  </div>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="sequences">
<h1>Sequences<a class="headerlink" href="#sequences" title="Permalink to this heading">¶</a></h1>
<div class="toctree-wrapper compound">
</div>
<p>The MAD Sequences are objects convenient to describe accelerators lattices built from a <em>list</em> of elements with increasing <code class="xref mad mad-data docutils literal notranslate"><span class="pre">s</span></code>-positions. The sequences are also containers that provide fast access to their elements by referring to their indexes, <code class="xref mad mad-data docutils literal notranslate"><span class="pre">s</span></code>-positions, or (mangled) names, or by running iterators constrained with ranges and predicates.</p>
<p>The <code class="xref mad mad-var docutils literal notranslate"><span class="pre">sequence</span></code> object is the <em>root object</em> of sequences that store information relative to lattices.</p>
<p>The <code class="xref mad mad-var docutils literal notranslate"><span class="pre">sequence</span></code> module extends the <a class="reference internal" href="mad_mod_types.html"><span class="doc">typeid</span></a> module with the <code class="xref mad mad-func docutils literal notranslate"><span class="pre">is_sequence</span></code> function, which returns <code class="xref mad mad-const docutils literal notranslate"><span class="pre">true</span></code> if its argument is a <code class="xref mad mad-var docutils literal notranslate"><span class="pre">sequence</span></code> object, <code class="xref mad mad-const docutils literal notranslate"><span class="pre">false</span></code> otherwise.</p>
<section id="attributes">
<h2>Attributes<a class="headerlink" href="#attributes" title="Permalink to this heading">¶</a></h2>
<p>The <code class="xref mad mad-var docutils literal notranslate"><span class="pre">sequence</span></code> object provides the following attributes:</p>
<dl class="simple">
<dt><strong>l</strong></dt><dd><p>A <em>number</em> specifying the length of the sequence <code class="docutils literal notranslate"><span class="pre">[m]</span></code>. A <code class="xref mad mad-const docutils literal notranslate"><span class="pre">nil</span></code> will be replaced by the computed lattice length. A value greater or equal to the computed lattice length will be used to place the <code class="docutils literal notranslate"><span class="pre">$end</span></code> marker. Other values will raise an error. (default: <code class="xref mad mad-const docutils literal notranslate"><span class="pre">nil</span></code>).</p>
</dd>
<dt><strong>dir</strong></dt><dd><p>A <em>number</em> holding one of <code class="xref mad mad-const docutils literal notranslate"><span class="pre">1</span></code> (forward) or <code class="xref mad mad-const docutils literal notranslate"><span class="pre">-1</span></code> (backward) and specifying the direction of the sequence. <a class="footnote-reference brackets" href="#f1" id="id1" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a> (default:~ <code class="xref mad mad-const docutils literal notranslate"><span class="pre">1</span></code>)</p>
</dd>
<dt><strong>refer</strong></dt><dd><p>A <em>string</em> holding one of <code class="docutils literal notranslate"><span class="pre">&quot;entry&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;centre&quot;</span></code> or <code class="docutils literal notranslate"><span class="pre">&quot;exit&quot;</span></code> to specify the default reference position in the elements to use for their placement. An element can override it with its <code class="docutils literal notranslate"><span class="pre">refpos</span></code> attribute, see <a class="reference internal" href="#element-positions">element positions</a> for details. (default: <code class="xref mad mad-const docutils literal notranslate"><span class="pre">nil</span></code> <span class="math notranslate nohighlight">\(\equiv\)</span> <code class="docutils literal notranslate"><span class="pre">&quot;centre&quot;</span></code>).</p>
</dd>
</dl>
<dl class="simple">
<dt><strong>minlen</strong></dt><dd><p>A <em>number</em> specifying the minimal length <code class="docutils literal notranslate"><span class="pre">[m]</span></code> when checking for negative drifts or when generating <em>implicit</em> drifts between elements in <span class="math notranslate nohighlight">\(s\)</span>-iterators returned by the method <code class="docutils literal notranslate"><span class="pre">:siter</span></code>. This attribute is automatically set to <span class="math notranslate nohighlight">\(10^{-6}\)</span> m when a sequence is created within the MADX environment. (default: <span class="math notranslate nohighlight">\(10^{-6}\)</span>)</p>
</dd>
<dt><strong>beam</strong></dt><dd><p>An attached <code class="xref mad mad-var docutils literal notranslate"><span class="pre">beam</span></code>. (default: <code class="xref mad mad-const docutils literal notranslate"><span class="pre">nil</span></code>)</p>
</dd>
</dl>
<p><strong>Warning</strong>: the following private and read-only attributes are present in all sequences and should <em>never be used, set or changed</em>; breaking this rule would lead to an <em>undefined behavior</em>:</p>
<dl class="simple">
<dt><strong>__dat</strong></dt><dd><p>A <em>table</em> containing all the private data of sequences.</p>
</dd>
<dt><strong>__cycle</strong></dt><dd><p>A <em>reference</em> to the element registered with the <code class="docutils literal notranslate"><span class="pre">:cycle</span></code> method. (default: <code class="xref mad mad-const docutils literal notranslate"><span class="pre">nil</span></code>)</p>
</dd>
</dl>
</section>
<section id="methods">
<h2>Methods<a class="headerlink" href="#methods" title="Permalink to this heading">¶</a></h2>
<p>The <code class="xref mad mad-var docutils literal notranslate"><span class="pre">sequence</span></code> object provides the following methods:</p>
<dl class="simple">
<dt><strong>elem</strong></dt><dd><p>A <em>method</em> <code class="docutils literal notranslate"><span class="pre">(idx)</span></code> returning the element stored at the positive index <code class="docutils literal notranslate"><span class="pre">idx</span></code> in the sequence, or <code class="xref mad mad-const docutils literal notranslate"><span class="pre">nil</span></code>.</p>
</dd>
<dt><strong>spos</strong></dt><dd><p>A <em>method</em> <code class="docutils literal notranslate"><span class="pre">(idx)</span></code> returning the <span class="math notranslate nohighlight">\(s\)</span>-position at the entry of the element stored at the positive index <code class="docutils literal notranslate"><span class="pre">idx</span></code> in the sequence, or <code class="xref mad mad-const docutils literal notranslate"><span class="pre">nil</span></code>.</p>
</dd>
<dt><strong>upos</strong></dt><dd><p>A <em>method</em> <code class="docutils literal notranslate"><span class="pre">(idx)</span></code> returning the <span class="math notranslate nohighlight">\(s\)</span>-position at the user-defined <code class="docutils literal notranslate"><span class="pre">refpos</span></code> offset of the element stored at the positive index <code class="docutils literal notranslate"><span class="pre">idx</span></code>
in the sequence, or <code class="xref mad mad-const docutils literal notranslate"><span class="pre">nil</span></code>.</p>
</dd>
<dt><strong>ds</strong></dt><dd><p>A <em>method</em> <code class="docutils literal notranslate"><span class="pre">(idx)</span></code> returning the length of the element stored at the positive index <code class="docutils literal notranslate"><span class="pre">idx</span></code> in the sequence, or <code class="xref mad mad-const docutils literal notranslate"><span class="pre">nil</span></code>.</p>
</dd>
<dt><strong>align</strong></dt><dd><p>A <em>method</em> <code class="docutils literal notranslate"><span class="pre">(idx)</span></code> returning a <em>set</em> specifying the misalignment of the element stored at the positive index <code class="docutils literal notranslate"><span class="pre">idx</span></code> in the sequence, or <code class="xref mad mad-const docutils literal notranslate"><span class="pre">nil</span></code>.</p>
</dd>
<dt><strong>index</strong></dt><dd><p>A <em>method</em> <code class="docutils literal notranslate"><span class="pre">(idx)</span></code> returning a positive index, or <code class="xref mad mad-const docutils literal notranslate"><span class="pre">nil</span></code>. If <code class="docutils literal notranslate"><span class="pre">idx</span></code> is negative, it is reflected versus the size of the sequence, e.g. <code class="xref mad mad-const docutils literal notranslate"><span class="pre">-1</span></code>
becomes <code class="docutils literal notranslate"><span class="pre">#self</span></code>, the index of the <code class="docutils literal notranslate"><span class="pre">$end</span></code> marker.</p>
</dd>
<dt><strong>name_of</strong></dt><dd><p>A <em>method</em> <code class="docutils literal notranslate"><span class="pre">(idx,</span> <span class="pre">[ref])</span></code> returning a <em>string</em> corresponding to the (mangled) name of the element at the index <code class="docutils literal notranslate"><span class="pre">idx</span></code> or <code class="xref mad mad-const docutils literal notranslate"><span class="pre">nil</span></code>. An element
name appearing more than once in the sequence will be mangled with an absolute count, e.g. <code class="docutils literal notranslate"><span class="pre">mq[3]</span></code>, or a relative count versus the optional
reference element <code class="docutils literal notranslate"><span class="pre">ref</span></code> determined by <code class="docutils literal notranslate"><span class="pre">:index_of</span></code>, e.g. <code class="docutils literal notranslate"><span class="pre">mq{-2}</span></code>.</p>
</dd>
<dt><strong>index_of</strong></dt><dd><p>A <em>method</em> <code class="docutils literal notranslate"><span class="pre">(a,</span> <span class="pre">[ref],</span> <span class="pre">[dir])</span></code> returning a <em>number</em> corresponding to the positive index of the element determined by the first argument or <code class="xref mad mad-const docutils literal notranslate"><span class="pre">nil</span></code>.
If <code class="docutils literal notranslate"><span class="pre">a</span></code> is a <em>number</em> (or a <em>string</em> representing a <em>number</em>), it is interpreted as the <span class="math notranslate nohighlight">\(s\)</span>-position of an element and returned as a second
<em>number</em>. If <code class="docutils literal notranslate"><span class="pre">a</span></code> is a <em>string</em>, it is interpreted as the (mangled) name of an element as returned by <code class="docutils literal notranslate"><span class="pre">:name_of</span></code>. Finally, <code class="docutils literal notranslate"><span class="pre">a</span></code> can be a <em>reference</em>
to an element to search for. The argument <code class="docutils literal notranslate"><span class="pre">ref</span></code> (default: <code class="docutils literal notranslate"><span class="pre">nil)</span></code> specifies the reference element determined by <code class="docutils literal notranslate"><span class="pre">:index_of(ref)</span></code> to use for
relative <span class="math notranslate nohighlight">\(s\)</span>-positions, for decoding mangled names with relative counts, or as the element to start searching from. The argument <code class="docutils literal notranslate"><span class="pre">dir</span></code>
(default: <code class="docutils literal notranslate"><span class="pre">1)</span></code> specifies the direction of the search with values <code class="xref mad mad-const docutils literal notranslate"><span class="pre">1</span></code> (forward), <code class="xref mad mad-const docutils literal notranslate"><span class="pre">-1</span></code> (backward), or <code class="xref mad mad-const docutils literal notranslate"><span class="pre">0</span></code> (no direction). The <code class="docutils literal notranslate"><span class="pre">dir=0</span></code>
case may return an index at half-integer if <code class="docutils literal notranslate"><span class="pre">a</span></code> is interpreted as an <span class="math notranslate nohighlight">\(s\)</span>-position pointing to an <em>implicit drift</em>.</p>
</dd>
<dt><strong>range_of</strong></dt><dd><p>A <em>method</em> <code class="docutils literal notranslate"><span class="pre">([rng],</span> <span class="pre">[ref],</span> <span class="pre">[dir]</span></code>) returning three <em>numbers</em> corresponding to the positive indexes <em>start</em> and <em>end</em> of the range and
its direction <em>dir</em>, or <code class="xref mad mad-const docutils literal notranslate"><span class="pre">nil</span></code> for an empty range. If <code class="docutils literal notranslate"><span class="pre">rng</span></code> is omitted, it returns <code class="xref mad mad-const docutils literal notranslate"><span class="pre">1</span></code>, <code class="docutils literal notranslate"><span class="pre">#self</span></code>, <code class="xref mad mad-const docutils literal notranslate"><span class="pre">1</span></code>, or <code class="docutils literal notranslate"><span class="pre">#self</span></code>, <code class="xref mad mad-const docutils literal notranslate"><span class="pre">1</span></code>, <code class="xref mad mad-const docutils literal notranslate"><span class="pre">-1</span></code>
if <code class="docutils literal notranslate"><span class="pre">dir</span></code> is negative. If <code class="docutils literal notranslate"><span class="pre">rng</span></code> is a <em>number</em> or a <em>string</em> with no <code class="docutils literal notranslate"><span class="pre">'/'</span></code> separator, it is interpreted as both <em>start</em> and <em>end</em> and
determined by <code class="docutils literal notranslate"><span class="pre">index_of</span></code>. If <code class="docutils literal notranslate"><span class="pre">rng</span></code> is a <em>string</em> containing the separator <code class="docutils literal notranslate"><span class="pre">'/'</span></code>, it is split in two <em>strings</em> interpreted as <em>start</em>
and <em>end</em>, both determined by <code class="docutils literal notranslate"><span class="pre">:index_of</span></code>. If <code class="docutils literal notranslate"><span class="pre">rng</span></code> is a <em>list</em>, it will be interpreted as {<em>start</em>, <em>end</em>, <code class="docutils literal notranslate"><span class="pre">[ref]</span></code>, <code class="docutils literal notranslate"><span class="pre">[dir]</span></code>},
both determined by <code class="docutils literal notranslate"><span class="pre">:index_of</span></code>, unless <code class="docutils literal notranslate"><span class="pre">ref</span></code> equals <code class="docutils literal notranslate"><span class="pre">'idx'</span></code> then both are determined by <code class="docutils literal notranslate"><span class="pre">:index</span></code> (i.e. a <em>number</em> is interpreted as an
index instead of a <span class="math notranslate nohighlight">\(s\)</span>-position). The arguments <code class="docutils literal notranslate"><span class="pre">ref</span></code> (default: <code class="xref mad mad-const docutils literal notranslate"><span class="pre">nil</span></code>) and <code class="docutils literal notranslate"><span class="pre">dir</span></code> (default: <code class="xref mad mad-const docutils literal notranslate"><span class="pre">1</span></code>) are forwarded to all invocations
of <code class="docutils literal notranslate"><span class="pre">:index_of</span></code> with a higher precedence than ones in the <em>list</em> <code class="docutils literal notranslate"><span class="pre">rng</span></code>, and a runtime error is raised if the method returns <code class="xref mad mad-const docutils literal notranslate"><span class="pre">nil</span></code>, i.e.
to disambiguate between a valid empty range and an invalid range.</p>
</dd>
<dt><strong>length_of</strong></dt><dd><p>A <em>method</em> <code class="docutils literal notranslate"><span class="pre">([rng],</span> <span class="pre">[ntrn],</span> <span class="pre">[dir]</span></code>) returning a <em>number</em> specifying the length of the range optionally including <code class="docutils literal notranslate"><span class="pre">ntrn</span></code> extra turns (default: <code class="xref mad mad-const docutils literal notranslate"><span class="pre">0</span></code>),
and calculated from the indexes returned by <code class="docutils literal notranslate"><span class="pre">:range_of([rng],</span> <span class="pre">nil,</span> <span class="pre">[dir])</span></code>.</p>
</dd>
<dt><strong>iter</strong></dt><dd><p>A <em>method</em> <code class="docutils literal notranslate"><span class="pre">([rng],</span> <span class="pre">[ntrn],</span> <span class="pre">[dir])</span></code> returning an iterator over the sequence elements. The optional range is determined by
<code class="xref mad mad-meth docutils literal notranslate"><span class="pre">:range_of(rng,</span> <span class="pre">[dir])</span></code>, optionally including <code class="docutils literal notranslate"><span class="pre">ntrn</span></code> turns (default: <code class="xref mad mad-const docutils literal notranslate"><span class="pre">0</span></code>). The optional direction <code class="docutils literal notranslate"><span class="pre">dir</span></code> specifies the forward <code class="xref mad mad-const docutils literal notranslate"><span class="pre">1</span></code>
or the backward <code class="xref mad mad-const docutils literal notranslate"><span class="pre">-1</span></code> direction of the iterator. If <code class="docutils literal notranslate"><span class="pre">rng</span></code> is not provided and the mtable is cycled, the <em>start</em> and <em>end</em> indexes are
determined by <code class="docutils literal notranslate"><span class="pre">:index_of(self.__cycle)</span></code>. When used with a generic <code class="docutils literal notranslate"><span class="pre">for</span></code> loop, the iterator returns at each element: its index,
the element itself, its <span class="math notranslate nohighlight">\(s\)</span>-position over the running loop and its signed length depending on the direction.</p>
</dd>
<dt><strong>siter</strong></dt><dd><p>A <em>method</em> <code class="docutils literal notranslate"><span class="pre">([rng],</span> <span class="pre">[ntrn],</span> <span class="pre">[dir])</span></code> returning an <span class="math notranslate nohighlight">\(s\)</span>-iterator over the sequence elements. The optional range is determined by
<code class="docutils literal notranslate"><span class="pre">:range_of([rng],</span> <span class="pre">nil,</span> <span class="pre">[dir])</span></code>, optionally including <code class="docutils literal notranslate"><span class="pre">ntrn</span></code> turns (default: <code class="xref mad mad-const docutils literal notranslate"><span class="pre">0</span></code>). The optional direction <code class="docutils literal notranslate"><span class="pre">dir</span></code> specifies the
forward <code class="xref mad mad-const docutils literal notranslate"><span class="pre">1</span></code> or the backward <code class="xref mad mad-const docutils literal notranslate"><span class="pre">-1</span></code> direction of the iterator. When used with a generic <code class="docutils literal notranslate"><span class="pre">for</span></code> loop, the iterator returns at each
iteration: its index, the element itself or an <em>implicit</em> <code class="docutils literal notranslate"><span class="pre">drift</span></code>, its <span class="math notranslate nohighlight">\(s\)</span>-position over the running loop and its signed length
depending on the direction. Each <em>implicit</em> drift is built on-the-fly by the iterator with a length equal to the gap between the elements
surrounding it and a half-integer index equal to the average of their indexes. The length of <em>implicit</em> drifts is bounded by the maximum
between the sequence attribute <code class="docutils literal notranslate"><span class="pre">minlen</span></code> and the <code class="docutils literal notranslate"><span class="pre">minlen</span></code> from the <a class="reference internal" href="mad_mod_const.html"><span class="doc">constant</span></a> module.</p>
</dd>
<dt><strong>foreach</strong></dt><dd><p>A <em>method</em> <code class="docutils literal notranslate"><span class="pre">(act,</span> <span class="pre">[rng],</span> <span class="pre">[sel],</span> <span class="pre">[not])</span></code> returning the sequence itself after applying the action <code class="docutils literal notranslate"><span class="pre">act</span></code> on the selected elements. If <code class="docutils literal notranslate"><span class="pre">act</span></code>
is a <em>set</em> representing the arguments in the packed form, the missing arguments will be extracted from the attributes <code class="docutils literal notranslate"><span class="pre">action</span></code>,
<code class="docutils literal notranslate"><span class="pre">range</span></code>, <code class="docutils literal notranslate"><span class="pre">select</span></code> and <code class="docutils literal notranslate"><span class="pre">default</span></code>. The action <code class="docutils literal notranslate"><span class="pre">act</span></code> must be a <em>callable</em> <code class="docutils literal notranslate"><span class="pre">(elm,</span> <span class="pre">idx,</span> <span class="pre">[midx])</span></code> applied to an element passed as
first argument and its index as second argument, the optional third argument being the index of the main element in case <code class="docutils literal notranslate"><span class="pre">elm</span></code> is a sub-element.
The optional range is used to generate the loop iterator <code class="docutils literal notranslate"><span class="pre">:iter([rng])</span></code>. The optional selector <code class="docutils literal notranslate"><span class="pre">sel</span></code> is a <em>callable</em> <code class="docutils literal notranslate"><span class="pre">(elm,</span> <span class="pre">idx,</span> <span class="pre">[midx])</span></code>
predicate selecting eligible elements for the action using the same arguments. The selector <code class="docutils literal notranslate"><span class="pre">sel</span></code> can be specified in other ways,
see <a class="reference internal" href="#element-selections">element selections</a> for details. The optional <em>logical</em> <code class="docutils literal notranslate"><span class="pre">not</span></code> (default: <code class="xref mad mad-const docutils literal notranslate"><span class="pre">false</span></code>) indicates how to interpret default selection, as
<em>all</em> or <em>none</em>, depending on the semantic of the action. <a class="footnote-reference brackets" href="#f2" id="id2" role="doc-noteref"><span class="fn-bracket">[</span>2<span class="fn-bracket">]</span></a></p>
</dd>
<dt><strong>select</strong></dt><dd><p>A <em>method</em> <code class="docutils literal notranslate"><span class="pre">([flg],</span> <span class="pre">[rng],</span> <span class="pre">[sel],</span> <span class="pre">[not])</span></code> returning the sequence itself after applying the action <code class="docutils literal notranslate"><span class="pre">:select([flg])</span></code> to the elements using
<code class="docutils literal notranslate"><span class="pre">:foreach(act,</span> <span class="pre">[rng],</span> <span class="pre">[sel],</span> <span class="pre">[not])</span></code>. By default sequence have all their elements deselected with only the <code class="docutils literal notranslate"><span class="pre">$end</span></code> marker <code class="docutils literal notranslate"><span class="pre">observed</span></code>.</p>
</dd>
<dt><strong>deselect</strong></dt><dd><p>A <em>method</em> <code class="docutils literal notranslate"><span class="pre">([flg],</span> <span class="pre">[rng],</span> <span class="pre">[sel],</span> <span class="pre">[not])</span></code> returning the sequence itself after applying the action <code class="docutils literal notranslate"><span class="pre">:deselect([flg])</span></code> to the elements
using <code class="docutils literal notranslate"><span class="pre">:foreach(act,</span> <span class="pre">[rng],</span> <span class="pre">[sel],</span> <span class="pre">[not])</span></code>. By default sequence have all their elements deselected with only the <code class="docutils literal notranslate"><span class="pre">$end</span></code> marker <code class="docutils literal notranslate"><span class="pre">observed</span></code>.</p>
</dd>
<dt><strong>filter</strong></dt><dd><p>A <em>method</em> <code class="docutils literal notranslate"><span class="pre">([rng],</span> <span class="pre">[sel],</span> <span class="pre">[not])</span></code> returning a <em>list</em> containing the positive indexes of the elements determined by <code class="docutils literal notranslate"><span class="pre">:foreach(filt_act,</span> <span class="pre">[rng],</span> <span class="pre">[sel],</span> <span class="pre">[not])</span></code>,
and its size. The <em>logical</em> <code class="docutils literal notranslate"><span class="pre">sel.subelem</span></code> specifies to select sub-elements too, and the <em>list</em> may contain non-integer indexes encoding their main element
index added to their relative position, i.e. <code class="docutils literal notranslate"><span class="pre">midx.sat</span></code>. The builtin <em>function</em> <code class="docutils literal notranslate"><span class="pre">math.modf(num)</span></code> allows to retrieve easily the main element <code class="docutils literal notranslate"><span class="pre">midx</span></code> and
the sub-element <code class="docutils literal notranslate"><span class="pre">sat</span></code>, e.g. <code class="docutils literal notranslate"><span class="pre">midx,sat</span> <span class="pre">=</span> <span class="pre">math.modf(val)</span></code>.</p>
</dd>
<dt><strong>install</strong></dt><dd><p>A <em>method</em> <code class="docutils literal notranslate"><span class="pre">(elm,</span> <span class="pre">[rng],</span> <span class="pre">[sel],</span> <span class="pre">[cmp])</span></code> returning the sequence itself after installing the elements in the <em>list</em> <code class="docutils literal notranslate"><span class="pre">elm</span></code> at their
<a class="reference internal" href="#element-positions">element positions</a>; unless <code class="docutils literal notranslate"><span class="pre">from=&quot;selected&quot;</span></code> is defined meaning multiple installations at positions relative to each element determined by the method
<code class="docutils literal notranslate"><span class="pre">:filter([rng],</span> <span class="pre">[sel],</span> <span class="pre">true)</span></code>. The <em>logical</em> <code class="docutils literal notranslate"><span class="pre">sel.subelem</span></code> is ignored. If the arguments are passed in the packed form, the extra attribute <code class="docutils literal notranslate"><span class="pre">elements</span></code>
will be used as a replacement for the argument <code class="docutils literal notranslate"><span class="pre">elm</span></code>. The <em>logical</em> <code class="docutils literal notranslate"><span class="pre">elm.subelem</span></code> specifies to install elements with <span class="math notranslate nohighlight">\(s\)</span>-position falling inside
sequence elements as sub-elements, and set their <code class="docutils literal notranslate"><span class="pre">sat</span></code> attribute accordingly. The optional <em>callable</em> <code class="docutils literal notranslate"><span class="pre">cmp(elmspos,</span> <span class="pre">spos[idx])</span></code> (default: <code class="docutils literal notranslate"><span class="pre">&quot;&lt;&quot;</span></code>) is used
to search for the <span class="math notranslate nohighlight">\(s\)</span>-position of the installation, where equal <span class="math notranslate nohighlight">\(s\)</span>-position are installed after (i.e. before with <code class="docutils literal notranslate"><span class="pre">&quot;&lt;=&quot;</span></code>), see <code class="docutils literal notranslate"><span class="pre">bsearch</span></code> from
the <a class="reference internal" href="mad_mod_miscfuns.html"><span class="doc">miscellaneous</span></a> module for details. The <em>implicit</em> drifts are checked after each element installation.</p>
</dd>
<dt><strong>replace</strong></dt><dd><p>A <em>method</em> <code class="docutils literal notranslate"><span class="pre">(elm,</span> <span class="pre">[rng],</span> <span class="pre">[sel])</span></code> returning the <em>list</em> of replaced elements by the elements in the <em>list</em> <code class="docutils literal notranslate"><span class="pre">elm</span></code> placed at their <a class="reference internal" href="#element-positions">element positions</a>, and the
<em>list</em> of their respective indexes, both determined by <code class="docutils literal notranslate"><span class="pre">:filter([rng],</span> <span class="pre">[sel],</span> <span class="pre">true)</span></code>. The <em>list</em> <code class="docutils literal notranslate"><span class="pre">elm</span></code> cannot contain instances of <code class="xref mad mad-var docutils literal notranslate"><span class="pre">sequence</span></code> or <code class="docutils literal notranslate"><span class="pre">bline</span></code>
elements and will be recycled as many times as needed to replace all selected elements. If the arguments are passed in the packed form, the extra attribute
<code class="docutils literal notranslate"><span class="pre">elements</span></code> will be used as a replacement for the argument <code class="docutils literal notranslate"><span class="pre">elm</span></code>. The <em>logical</em> <code class="docutils literal notranslate"><span class="pre">sel.subelem</span></code> specifies to replace selected sub-elements too and set
their <code class="docutils literal notranslate"><span class="pre">sat</span></code> attribute to the same value. The <em>implicit</em> drifts are checked only once all elements have been replaced.</p>
</dd>
<dt><strong>remove</strong></dt><dd><p>A <em>method</em> <code class="docutils literal notranslate"><span class="pre">([rng],</span> <span class="pre">[sel])</span></code> returning the <em>list</em> of removed elements and the <em>list</em> of their respective indexes, both determined by <code class="docutils literal notranslate"><span class="pre">:filter([rng],</span> <span class="pre">[sel],</span> <span class="pre">true)</span></code>.
The <em>logical</em> <code class="docutils literal notranslate"><span class="pre">sel.subelem</span></code> specifies to remove selected sub-elements too.</p>
</dd>
<dt><strong>move</strong></dt><dd><p>A <em>method</em> <code class="docutils literal notranslate"><span class="pre">([rng],</span> <span class="pre">[sel])</span></code> returning the sequence itself after updating the <a class="reference internal" href="#element-positions">element positions</a> at the indexes determined by <code class="docutils literal notranslate"><span class="pre">:filter([rng],</span> <span class="pre">[sel],</span> <span class="pre">true)</span></code>.
The <em>logical</em> <code class="docutils literal notranslate"><span class="pre">sel.subelem</span></code> is ignored. The elements must keep their order in the sequence and surrounding <em>implicit</em> drifts are checked only once all elements
have been moved. <a class="footnote-reference brackets" href="#f3" id="id3" role="doc-noteref"><span class="fn-bracket">[</span>3<span class="fn-bracket">]</span></a></p>
</dd>
<dt><strong>update</strong></dt><dd><p>A <em>method</em> <code class="docutils literal notranslate"><span class="pre">()</span></code> returning the sequence itself after recomputing the positions of all elements.</p>
</dd>
<dt><strong>misalign</strong></dt><dd><p>A <em>method</em> <code class="docutils literal notranslate"><span class="pre">(algn,</span> <span class="pre">[rng],</span> <span class="pre">[sel])</span></code> returning the sequence itself after setting the <a class="reference internal" href="mad_gen_elements.html#sec-elm-misalign"><span class="std std-ref">element misalignments</span></a> from
<code class="docutils literal notranslate"><span class="pre">algn</span></code> at the indexes determined by <code class="docutils literal notranslate"><span class="pre">:filter([rng],</span> <span class="pre">[sel],</span> <span class="pre">true)</span></code>. If <code class="docutils literal notranslate"><span class="pre">algn</span></code> is a <em>mappable</em>, it will be used to misalign the filtered elements.
If <code class="docutils literal notranslate"><span class="pre">algn</span></code> is a <em>iterable</em>, it will be accessed using the filtered elements indexes to retrieve their specific misalignment.
If <code class="docutils literal notranslate"><span class="pre">algn</span></code> is a <em>callable</em> <code class="docutils literal notranslate"><span class="pre">(idx)</span></code>, it will be invoked for each filtered element with their index as solely argument to retrieve their specific misalignment.</p>
</dd>
<dt><strong>reflect</strong></dt><dd><p>A <em>method</em> <code class="docutils literal notranslate"><span class="pre">([name])</span></code> returning a new sequence from the sequence reversed, and named from the optional <em>string</em> <code class="docutils literal notranslate"><span class="pre">name</span></code> (default: <code class="docutils literal notranslate"><span class="pre">self.name..'_rev'</span></code>).</p>
</dd>
<dt><strong>cycle</strong></dt><dd><p>A <em>method</em> <code class="docutils literal notranslate"><span class="pre">(a)</span></code> returning the sequence itself after checking that <code class="docutils literal notranslate"><span class="pre">a</span></code> is a valid reference using <code class="docutils literal notranslate"><span class="pre">:index_of(a)</span></code>, and storing it in the <code class="docutils literal notranslate"><span class="pre">__cycle</span></code> attribute,
itself erased by the methods editing the sequence like <code class="docutils literal notranslate"><span class="pre">:install</span></code>, <code class="docutils literal notranslate"><span class="pre">:replace</span></code>, <code class="docutils literal notranslate"><span class="pre">:remove</span></code>, <code class="docutils literal notranslate"><span class="pre">:share</span></code>, and <code class="docutils literal notranslate"><span class="pre">:unique</span></code>.</p>
</dd>
<dt><strong>share</strong></dt><dd><p>A <em>method</em> <code class="docutils literal notranslate"><span class="pre">(seq2)</span></code> returning the <em>list</em> of elements removed from the <code class="docutils literal notranslate"><span class="pre">seq2</span></code> and the <em>list</em> of their respective indexes, and replaced by the elements from the
sequence with the same name when they are unique in both sequences.</p>
</dd>
<dt><strong>unique</strong></dt><dd><p>A <em>method</em> <code class="docutils literal notranslate"><span class="pre">([fmt])</span></code> returning the sequence itself after replacing all non-unique elements by new instances sharing the same parents.
The optional <code class="docutils literal notranslate"><span class="pre">fmt</span></code> must be a <em>callable</em> <code class="docutils literal notranslate"><span class="pre">(name,</span> <span class="pre">cnt,</span> <span class="pre">idx)</span></code> that returns the mangled name of the new instance build from the element <code class="docutils literal notranslate"><span class="pre">name</span></code>,
its count <code class="docutils literal notranslate"><span class="pre">cnt</span></code> and its index <code class="docutils literal notranslate"><span class="pre">idx</span></code> in the sequence. If the optional <code class="docutils literal notranslate"><span class="pre">fmt</span></code> is a <em>string</em>, the mangling <em>callable</em> is built by binding <code class="docutils literal notranslate"><span class="pre">fmt</span></code>
as first argument to the function <code class="docutils literal notranslate"><span class="pre">string.format</span></code> from the standard library, see
<a class="reference external" href="http://github.com/MethodicalAcceleratorDesign/MADdocs/blob/master/lua52-refman-madng.pdf">Lua 5.2</a> §6.4 for details.</p>
</dd>
<dt><strong>publish</strong></dt><dd><p>A <em>method</em> <code class="docutils literal notranslate"><span class="pre">(env,</span> <span class="pre">[keep])</span></code> returning the sequence after publishing all its elements in the environment <code class="docutils literal notranslate"><span class="pre">env</span></code>. If the <em>logical</em> <code class="docutils literal notranslate"><span class="pre">keep</span></code> is
<code class="xref mad mad-const docutils literal notranslate"><span class="pre">true</span></code>, the method will preserve existing elements from being overridden. This method is automatically invoked with <code class="docutils literal notranslate"><span class="pre">keep=true</span></code> when sequences
are created within the <code class="docutils literal notranslate"><span class="pre">MADX</span></code> environment.</p>
</dd>
<dt><strong>copy</strong></dt><dd><p>A <em>method</em> <code class="docutils literal notranslate"><span class="pre">([name],</span> <span class="pre">[owner])</span></code> returning a new sequence from a copy of <code class="docutils literal notranslate"><span class="pre">self</span></code>, with the optional <code class="docutils literal notranslate"><span class="pre">name</span></code> and the optional attribute <code class="docutils literal notranslate"><span class="pre">owner</span></code> set.
If the sequence is a view, so will be the copy unless <code class="docutils literal notranslate"><span class="pre">owner</span> <span class="pre">==</span> <span class="pre">true</span></code>.</p>
</dd>
<dt><strong>set_readonly</strong></dt><dd><p>Set the sequence as read-only, including its columns.</p>
</dd>
<dt><strong>save_flags</strong></dt><dd><p>A <em>method</em> <code class="docutils literal notranslate"><span class="pre">([flgs])</span></code> saving the flags of all the elements to the optional <em>iterable</em> <code class="docutils literal notranslate"><span class="pre">flgs</span></code> (default: <code class="docutils literal notranslate"><span class="pre">{}</span></code>) and return it.</p>
</dd>
<dt><strong>restore_flags</strong></dt><dd><p>A <em>method</em> <code class="docutils literal notranslate"><span class="pre">(flgs)</span></code> restoring the flags of all the elements from the <em>iterable</em> <code class="docutils literal notranslate"><span class="pre">flgs</span></code>. The indexes of the flags must match the indexes of the elements
in the sequence.</p>
</dd>
<dt><strong>dumpseq</strong></dt><dd><p>A <em>method</em> <code class="docutils literal notranslate"><span class="pre">([fil],</span> <span class="pre">[info])</span></code> displaying on the optional file <code class="docutils literal notranslate"><span class="pre">fil</span></code> (default: <code class="docutils literal notranslate"><span class="pre">io.stdout</span></code>) information related to the position and length of the elements.
Useful to identify negative drifts and badly positioned elements. The optional argument <code class="docutils literal notranslate"><span class="pre">info</span></code> indicates to display extra information like elements misalignments.</p>
</dd>
<dt><strong>check_sequ</strong></dt><dd><p>A <em>method</em> () checking the integrity of the sequence and its dictionary, for debugging purpose only.</p>
</dd>
</dl>
</section>
<section id="metamethods">
<h2>Metamethods<a class="headerlink" href="#metamethods" title="Permalink to this heading">¶</a></h2>
<p>The <code class="xref mad mad-var docutils literal notranslate"><span class="pre">sequence</span></code> object provides the following metamethods:</p>
<dl>
<dt><strong>__len</strong></dt><dd><p>A <em>metamethod</em> () called by the length operator <code class="docutils literal notranslate"><span class="pre">#</span></code> to return the size of the sequence, i.e. the number of elements stored including the <code class="docutils literal notranslate"><span class="pre">&quot;$start&quot;</span></code> and
<code class="docutils literal notranslate"><span class="pre">&quot;$end&quot;</span></code> markers.</p>
</dd>
<dt><strong>__index</strong></dt><dd><p>A <em>metamethod</em> <code class="docutils literal notranslate"><span class="pre">(key)</span></code> called by the indexing operator <code class="docutils literal notranslate"><span class="pre">[key]</span></code> to return the <em>value</em> of an attribute determined by <em>key</em>. The <em>key</em> is interpreted differently depending on its type with the following precedence:</p>
<ol class="arabic simple">
<li><p>A <em>number</em> is interpreted as an element index and returns the element or <code class="xref mad mad-const docutils literal notranslate"><span class="pre">nil</span></code>.</p></li>
<li><p>Other <em>key</em> types are interpreted as <em>object</em> attributes subject to object model lookup.</p></li>
<li><p>If the <em>value</em> associated with <em>key</em> is <code class="xref mad mad-const docutils literal notranslate"><span class="pre">nil</span></code>, then <em>key</em> is interpreted as an element name and returns either the element or an <em>iterable</em> on the elements with the same name. <a class="footnote-reference brackets" href="#f4" id="id4" role="doc-noteref"><span class="fn-bracket">[</span>4<span class="fn-bracket">]</span></a></p></li>
<li><p>Otherwise returns <code class="xref mad mad-const docutils literal notranslate"><span class="pre">nil</span></code>.</p></li>
</ol>
</dd>
<dt><strong>__newindex</strong></dt><dd><p>A <em>metamethod</em> <code class="docutils literal notranslate"><span class="pre">(key,</span> <span class="pre">val)</span></code> called by the assignment operator <code class="docutils literal notranslate"><span class="pre">[key]=val</span></code> to create new attributes for the pairs (<em>key</em>, <em>value</em>).
If <em>key</em> is a <em>number</em> specifying the index or a <em>string</em> specifying the name of an existing element, the following error is raised:</p>
<p><code class="docutils literal notranslate"><span class="pre">&quot;invalid</span> <span class="pre">sequence</span> <span class="pre">write</span> <span class="pre">access</span> <span class="pre">(use</span> <span class="pre">replace</span> <span class="pre">method)&quot;</span></code></p>
</dd>
<dt><strong>__init</strong></dt><dd><p>A <em>metamethod</em> () called by the constructor to compute the elements positions. <a class="footnote-reference brackets" href="#f5" id="id5" role="doc-noteref"><span class="fn-bracket">[</span>5<span class="fn-bracket">]</span></a></p>
</dd>
<dt><strong>__copy</strong></dt><dd><p>A <em>metamethod</em> () similar to the <code class="xref mad mad-meth docutils literal notranslate"><span class="pre">:copy</span></code> <em>method</em>.</p>
</dd>
</dl>
<p>The following attribute is stored with metamethods in the metatable, but has different purpose:</p>
<p><strong>__sequ</strong> A unique private <em>reference</em> that characterizes sequences.</p>
</section>
<section id="sequences-creation">
<h2>Sequences creation<a class="headerlink" href="#sequences-creation" title="Permalink to this heading">¶</a></h2>
<p>During its creation as an <em>object</em>, a sequence can defined its attributes as any object, and the <em>list</em> of its elements that must form a
<em>sequence</em> of increasing <span class="math notranslate nohighlight">\(s\)</span>-positions. When subsequences are part of this <em>list</em>, they are replaced by their respective elements as a
sequence <em>element</em> cannot be present inside other sequences. If the length of the sequence is not provided, it will be computed and set automatically.
During their creation, sequences compute the <span class="math notranslate nohighlight">\(s\)</span>-positions of their elements as described in the section <a class="reference internal" href="#element-positions">element positions</a>, and check for overlapping
elements that would raise a “negative drift” runtime error.</p>
<p>The following example shows how to create a sequence form a <em>list</em> of elements and subsequences:</p>
<div class="highlight-mad notranslate"><div class="highlight"><pre><span></span><span class="kd">local</span> <span class="n">sequence</span><span class="p">,</span> <span class="n">drift</span><span class="p">,</span> <span class="n">marker</span> <span class="kr">in</span> <span class="n">MAD</span><span class="p">.</span><span class="n">element</span>
<span class="kd">local</span> <span class="n">df</span><span class="p">,</span> <span class="n">mk</span> <span class="o">=</span> <span class="n">drift</span> <span class="s1">&#39;df&#39;</span> <span class="p">{</span><span class="n">l</span><span class="o">=</span><span class="mi">1</span><span class="p">},</span> <span class="n">marker</span> <span class="s1">&#39;mk&#39;</span> <span class="p">{}</span>
<span class="kd">local</span> <span class="n">seq</span> <span class="o">=</span> <span class="n">sequence</span> <span class="s1">&#39;seq&#39;</span> <span class="p">{</span>
<span class="n">df</span> <span class="s1">&#39;df1&#39;</span> <span class="p">{},</span> <span class="n">mk</span> <span class="s1">&#39;mk1&#39;</span> <span class="p">{},</span>
<span class="n">sequence</span> <span class="p">{</span>
   <span class="n">sequence</span> <span class="p">{</span> <span class="n">mk</span> <span class="s1">&#39;mk0&#39;</span> <span class="p">{}</span> <span class="p">},</span>
   <span class="n">df</span> <span class="s1">&#39;df.s&#39;</span> <span class="p">{},</span> <span class="n">mk</span> <span class="s1">&#39;mk.s&#39;</span> <span class="p">{}</span>
<span class="p">},</span>
<span class="n">df</span> <span class="s1">&#39;df2&#39;</span> <span class="p">{},</span> <span class="n">mk</span> <span class="s1">&#39;mk2&#39;</span> <span class="p">{},</span>
<span class="p">}</span> <span class="p">:</span><span class="n">dumpseq</span><span class="p">()</span>
</pre></div>
</div>
<p>Displays:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>sequence: seq, l=3
idx  kind     name         l          dl       spos       upos    uds
001  marker   start        0.000       0       0.000      0.000   0.000
002  drift    df1          1.000       0       0.000      0.500   0.500
003  marker   mk1          0.000       0       1.000      1.000   0.000
004  marker   mk0          0.000       0       1.000      1.000   0.000
005  drift    df.s         1.000       0       1.000      1.500   0.500
006  marker   mk.s         0.000       0       2.000      2.000   0.000
007  drift    df2          1.000       0       2.000      2.500   0.500
008  marker   mk2          0.000       0       3.000      3.000   0.000
009  marker   end          0.000       0       3.000      3.000   0.000
</pre></div>
</div>
</section>
<section id="element-positions">
<span id="elpos"></span><h2>Element positions<a class="headerlink" href="#element-positions" title="Permalink to this heading">¶</a></h2>
<p>A sequence looks at the following attributes of an element, including sub-sequences, when installing it, <em>and only at that time</em>, to determine its position:</p>
<dl class="simple">
<dt><strong>at</strong></dt><dd><p>A <em>number</em> holding the position in [m] of the element in the sequence relative to the position specified by the <code class="docutils literal notranslate"><span class="pre">from</span></code> attribute.</p>
</dd>
<dt><strong>from</strong></dt><dd><p>A <em>string</em> holding one of <code class="docutils literal notranslate"><span class="pre">&quot;start&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;prev&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;next&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;end&quot;</span></code> or <code class="docutils literal notranslate"><span class="pre">&quot;selected&quot;</span></code>, or the (mangled) name of another element to use as the reference position,
or a <em>number</em> holding a position in [m] from the start of the sequence. (default: <code class="docutils literal notranslate"><span class="pre">&quot;start&quot;</span></code> if <code class="docutils literal notranslate"><span class="pre">at</span></code><span class="math notranslate nohighlight">\(\geq 0\)</span>, <code class="docutils literal notranslate"><span class="pre">&quot;end&quot;</span></code> if <code class="docutils literal notranslate"><span class="pre">at</span></code><span class="math notranslate nohighlight">\(&lt;0\)</span>, and <code class="docutils literal notranslate"><span class="pre">&quot;prev&quot;</span></code>
otherwise)</p>
</dd>
<dt><strong>refpos</strong></dt><dd><p>A <em>string</em> holding one of <code class="docutils literal notranslate"><span class="pre">&quot;entry&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;centre&quot;</span></code> or <code class="docutils literal notranslate"><span class="pre">&quot;exit&quot;</span></code>,  or the (mangled) name of a sequence sub-element to use as the reference position,
or a <em>number</em> specifying a position [m] from the start of the element, all of them resulting in an offset to substract to the <code class="docutils literal notranslate"><span class="pre">at</span></code> attribute to find the
<span class="math notranslate nohighlight">\(s\)</span>-position of the element entry. (default: <code class="xref mad mad-const docutils literal notranslate"><span class="pre">nil</span></code> <span class="math notranslate nohighlight">\(\equiv\)</span> <code class="docutils literal notranslate"><span class="pre">self.refer</span></code>).</p>
</dd>
<dt><strong>shared</strong></dt><dd><p>A <em>logical</em> specifying if an element is used at different positions in the same sequence definition, i.e. shared multiple times,
through temporary instances to store the many <code class="docutils literal notranslate"><span class="pre">at</span></code> and <code class="docutils literal notranslate"><span class="pre">from</span></code> attributes needed to specify its positions.
Once built, the sequence will drop these temporary instances in favor of their common parent, i.e. the original shared element.</p>
</dd>
</dl>
<p><strong>Warning:</strong> The <code class="docutils literal notranslate"><span class="pre">at</span></code> and <code class="docutils literal notranslate"><span class="pre">from</span></code> attributes are not considered as intrinsic properties of the elements and are used only once during installation.
Any reuse of these attributes is the responsibility of the user, including the consistency between <code class="docutils literal notranslate"><span class="pre">at</span></code> and <code class="docutils literal notranslate"><span class="pre">from</span></code> after updates.</p>
</section>
<section id="element-selections">
<h2>Element selections<a class="headerlink" href="#element-selections" title="Permalink to this heading">¶</a></h2>
<p>The element selection in sequence use predicates in combination with iterators. The sequence iterator manages the range of elements where to apply the selection,
while the predicate says if an element in this range is illegible for the selection. In order to ease the use of methods based on the <code class="docutils literal notranslate"><span class="pre">:foreach</span></code> method,
the selector predicate <code class="docutils literal notranslate"><span class="pre">sel</span></code> can be built from different types of information provided in a <em>set</em> with the following attributes:</p>
<dl class="simple">
<dt><strong>flag</strong></dt><dd><p>A <em>number</em> interpreted as a flags mask to pass to the element method <code class="docutils literal notranslate"><span class="pre">:is_selected</span></code>. It should not be confused with the flags passed as argument to methods
<code class="docutils literal notranslate"><span class="pre">:select</span></code> and <code class="docutils literal notranslate"><span class="pre">:deselect</span></code>, as both flags can be used together but with different meanings!</p>
</dd>
<dt><strong>pattern</strong></dt><dd><p>A <em>string</em> interpreted as a pattern to match the element name using <code class="docutils literal notranslate"><span class="pre">string.match</span></code> from the standard library, see
<a class="reference external" href="http://github.com/MethodicalAcceleratorDesign/MADdocs/blob/master/lua52-refman-madng.pdf">Lua 5.2</a> §6.4 for details.</p>
</dd>
<dt><strong>class</strong></dt><dd><p>An <em>element</em> interpreted as a <em>class</em> to pass to the element method <code class="docutils literal notranslate"><span class="pre">:is_instansceOf</span></code>.</p>
</dd>
<dt><strong>list</strong></dt><dd><p>An <em>iterable</em> interpreted as a <em>list</em> used to build a <em>set</em> and select the elements by their name, i.e. the built predicate will use <code class="docutils literal notranslate"><span class="pre">tbl[elm.name]</span></code>
as a <em>logical</em>. If the <em>iterable</em> is a single item, e.g. a <em>string</em>, it will be converted first to a <em>list</em>.</p>
</dd>
<dt><strong>table</strong></dt><dd><p>A <em>mappable</em> interpreted as a <em>set</em> used to select the elements by their name, i.e. the built predicate will use <code class="docutils literal notranslate"><span class="pre">tbl[elm.name]</span></code> as a <em>logical</em>.
If the <em>mappable</em> contains a <em>list</em> or is a single item, it will be converted first to a <em>list</em> and its <em>set</em> part will be discarded.</p>
</dd>
<dt><strong>select</strong></dt><dd><p>A <em>callable</em> interpreted as the selector itself, which allows to build any kind of predicate or to complete the restrictions already built above.</p>
</dd>
<dt><strong>subelem</strong></dt><dd><p>A <em>boolean</em> indicating to include or not the sub-elements in the scanning loop. The predicate and the action receive the sub-element and its sub-index as
first and second argument, and the main element index as third argument.</p>
</dd>
</dl>
<p>All these attributes are used in the aforementioned order to incrementally build predicates that are combined with logical conjunctions, i.e. <code class="docutils literal notranslate"><span class="pre">and</span></code>’ed,
to give the final predicate used by the <code class="docutils literal notranslate"><span class="pre">:foreach</span></code> method. If only one of these attributes is needed, it is possible to pass it directly in <code class="docutils literal notranslate"><span class="pre">sel</span></code>,
not as an attribute in a <em>set</em>, and its type will be used to determine the kind of predicate to build. For example, <code class="docutils literal notranslate"><span class="pre">self:foreach(act,</span> <span class="pre">monitor)</span></code> is equivalent
to <code class="docutils literal notranslate"><span class="pre">self:foreach{action=act,</span> <span class="pre">class=monitor}</span></code>.</p>
</section>
<section id="indexes-names-and-counts">
<h2>Indexes, names and counts<a class="headerlink" href="#indexes-names-and-counts" title="Permalink to this heading">¶</a></h2>
<p>Indexing a sequence triggers a complex look up mechanism where the arguments will be interpreted in various ways as described in the <code class="docutils literal notranslate"><span class="pre">:__index</span></code> metamethod.
A <em>number</em> will be interpreted as a relative slot index in the list of elements, and a negative index will be considered as relative to the end of the sequence,
i.e. <code class="xref mad mad-const docutils literal notranslate"><span class="pre">-1</span></code> is the <code class="docutils literal notranslate"><span class="pre">$end</span></code> marker. Non-<em>number</em> will be interpreted first as an object key (can be anything), looking for sequence methods or attributes;
then as an element name if nothing was found.</p>
<p>If an element exists but its name is not unique in the sequence, an <em>iterable</em> is returned. An <em>iterable</em> supports the length <code class="docutils literal notranslate"><span class="pre">#</span></code> operator to retrieve the
number of elements with the same name, the indexing operator <code class="docutils literal notranslate"><span class="pre">[]</span></code> waiting for a count <span class="math notranslate nohighlight">\(n\)</span> to retrieve the <span class="math notranslate nohighlight">\(n\)</span>-th element from the start with that name,
and the iterator <code class="docutils literal notranslate"><span class="pre">ipairs</span></code> to use with generic <code class="docutils literal notranslate"><span class="pre">for</span></code> loops.</p>
<p>The returned <em>iterable</em> is in practice a proxy, i.e. a fake intermediate object that emulates the expected behavior, and any attempt to access the proxy in
another manner should raise a runtime error.</p>
<p><strong>Warning:</strong> The indexing operator <code class="docutils literal notranslate"><span class="pre">[]</span></code> interprets a <em>number</em> as a (relative) element index as the method <code class="docutils literal notranslate"><span class="pre">:index</span></code>, while the method <code class="docutils literal notranslate"><span class="pre">:index_of</span></code> interprets a
<em>number</em> as a (relative) element <span class="math notranslate nohighlight">\(s\)</span>-position [m].</p>
<p>The following example shows how to access to the elements through indexing and the <em>iterable</em>::</p>
<div class="highlight-mad notranslate"><div class="highlight"><pre><span></span><span class="kd">local</span> <span class="n">sequence</span><span class="p">,</span> <span class="n">drift</span><span class="p">,</span> <span class="n">marker</span> <span class="kr">in</span> <span class="n">MAD</span><span class="p">.</span><span class="n">element</span>
<span class="kd">local</span> <span class="n">seq</span> <span class="o">=</span> <span class="n">sequence</span> <span class="p">{</span>
<span class="n">drift</span> <span class="s1">&#39;df&#39;</span> <span class="p">{</span> <span class="n">id</span><span class="o">=</span><span class="mi">1</span> <span class="p">},</span> <span class="n">marker</span> <span class="s1">&#39;mk&#39;</span> <span class="p">{</span> <span class="n">id</span><span class="o">=</span><span class="mi">2</span> <span class="p">},</span>
<span class="n">drift</span> <span class="s1">&#39;df&#39;</span> <span class="p">{</span> <span class="n">id</span><span class="o">=</span><span class="mi">3</span> <span class="p">},</span> <span class="n">marker</span> <span class="s1">&#39;mk&#39;</span> <span class="p">{</span> <span class="n">id</span><span class="o">=</span><span class="mi">4</span> <span class="p">},</span>
<span class="n">drift</span> <span class="s1">&#39;df&#39;</span> <span class="p">{</span> <span class="n">id</span><span class="o">=</span><span class="mi">5</span> <span class="p">},</span> <span class="n">marker</span> <span class="s1">&#39;mk&#39;</span> <span class="p">{</span> <span class="n">id</span><span class="o">=</span><span class="mi">6</span> <span class="p">},</span>
<span class="p">}</span>
<span class="nb">print</span><span class="p">(</span><span class="n">seq</span><span class="p">[</span> <span class="mi">1</span><span class="p">].</span><span class="n">name</span><span class="p">)</span> <span class="c1">-- display: $start (start marker)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">seq</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">].</span><span class="n">name</span><span class="p">)</span> <span class="c1">-- display: $end   (end   marker)</span>

<span class="nb">print</span><span class="p">(</span><span class="o">#</span><span class="n">seq</span><span class="p">.</span><span class="n">df</span><span class="p">,</span> <span class="n">seq</span><span class="p">.</span><span class="n">df</span><span class="p">[</span><span class="mi">3</span><span class="p">].</span><span class="n">id</span><span class="p">)</span>                        <span class="c1">-- display: 3   5</span>
<span class="kr">for</span> <span class="n">_</span><span class="p">,</span><span class="n">e</span> <span class="kr">in</span> <span class="nb">ipairs</span><span class="p">(</span><span class="n">seq</span><span class="p">.</span><span class="n">df</span><span class="p">)</span> <span class="kr">do</span> <span class="nb">io.write</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="s2">&quot; &quot;</span><span class="p">)</span> <span class="kr">end</span> <span class="c1">-- display: 1 3 5</span>
<span class="kr">for</span> <span class="n">_</span><span class="p">,</span><span class="n">e</span> <span class="kr">in</span> <span class="nb">ipairs</span><span class="p">(</span><span class="n">seq</span><span class="p">.</span><span class="n">mk</span><span class="p">)</span> <span class="kr">do</span> <span class="nb">io.write</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="s2">&quot; &quot;</span><span class="p">)</span> <span class="kr">end</span> <span class="c1">-- display: 2 4 6</span>

<span class="c1">-- print name of drift with id=3 in absolute and relative to id=6.</span>
<span class="nb">print</span><span class="p">(</span><span class="n">seq</span><span class="p">:</span><span class="n">name_of</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>       <span class="c1">-- display: df[2]  (2nd df from start)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">seq</span><span class="p">:</span><span class="n">name_of</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">))</span>   <span class="c1">-- display: df{-3} (3rd df before last mk)</span>
</pre></div>
</div>
<p>The last two lines of code display the name of the same element but mangled with absolute and relative counts.</p>
</section>
<section id="iterators-and-ranges">
<h2>Iterators and ranges<a class="headerlink" href="#iterators-and-ranges" title="Permalink to this heading">¶</a></h2>
<p>Ranging a sequence triggers a complex look up mechanism where the arguments will be interpreted in various ways as described in the <code class="docutils literal notranslate"><span class="pre">:range_of</span></code> method,
itself based on the methods <code class="docutils literal notranslate"><span class="pre">:index_of</span></code> and <code class="docutils literal notranslate"><span class="pre">:index</span></code>. The number of elements selected by a sequence range can be computed by the <code class="docutils literal notranslate"><span class="pre">:length_of</span></code> method,
which accepts an extra <em>number</em> of turns to consider in the calculation.</p>
<p>The sequence iterators are created by the methods <code class="docutils literal notranslate"><span class="pre">:iter</span></code> and <code class="docutils literal notranslate"><span class="pre">:siter</span></code>, and both are based on the <code class="docutils literal notranslate"><span class="pre">:range_of</span></code> method as mentioned in their descriptions
and includes an extra <em>number</em> of turns as for the method <code class="docutils literal notranslate"><span class="pre">:length_of</span></code>, and a direction <code class="xref mad mad-const docutils literal notranslate"><span class="pre">1</span></code> (forward) or <code class="xref mad mad-const docutils literal notranslate"><span class="pre">-1</span></code> (backward) for the iteration.
The <code class="docutils literal notranslate"><span class="pre">:siter</span></code> differs from the <code class="docutils literal notranslate"><span class="pre">:iter</span></code> by its loop, which returns not only the sequence elements but also <em>implicit</em> drifts built on-the-fly when a gap
<span class="math notranslate nohighlight">\(&gt;10^{-10}\)</span> m is detected between two sequence elements. Such implicit drift have half-integer indexes and make the iterator “continuous” in <span class="math notranslate nohighlight">\(s\)</span>-positions.</p>
<p>The method <code class="docutils literal notranslate"><span class="pre">:foreach</span></code> uses the iterator returned by <code class="docutils literal notranslate"><span class="pre">:iter</span></code> with a range as its sole argument to loop over the elements where to apply the predicate before
executing the action. The methods <code class="docutils literal notranslate"><span class="pre">:select</span></code>, <code class="docutils literal notranslate"><span class="pre">:deselect</span></code>, <code class="docutils literal notranslate"><span class="pre">:filter</span></code>, <code class="docutils literal notranslate"><span class="pre">:install</span></code>, <code class="docutils literal notranslate"><span class="pre">:replace</span></code>, <code class="docutils literal notranslate"><span class="pre">:remove</span></code>, <code class="docutils literal notranslate"><span class="pre">:move</span></code>, and <code class="docutils literal notranslate"><span class="pre">:misalign</span></code> are all based
directly or indirectly on the <code class="docutils literal notranslate"><span class="pre">:foreach</span></code> method. Hence, to iterate backward over a sequence range, these methods have to use either its <em>list</em> form or a numerical range.
For example the invocation <code class="docutils literal notranslate"><span class="pre">seq:foreach(\e</span> <span class="pre">-&gt;</span> <span class="pre">print(e.name),</span> <span class="pre">{2,</span> <span class="pre">2,</span> <span class="pre">'idx',</span> <span class="pre">-1)</span></code> will iterate backward over the entire sequence <code class="docutils literal notranslate"><span class="pre">seq</span></code> excluding the <code class="docutils literal notranslate"><span class="pre">$start</span></code>
and <code class="docutils literal notranslate"><span class="pre">$end</span></code> markers, while the invocation <code class="docutils literal notranslate"><span class="pre">seq:foreach(\e</span> <span class="pre">-&gt;</span> <span class="pre">print(e.name),</span> <span class="pre">5..2..-1)</span></code> will iterate backward over the elements with <span class="math notranslate nohighlight">\(s\)</span>-positions sitting in the
interval <span class="math notranslate nohighlight">\([2,5]\)</span> m.</p>
<p>The tracking commands <code class="docutils literal notranslate"><span class="pre">survey</span></code> and <code class="xref mad mad-var docutils literal notranslate"><span class="pre">track</span></code> use the iterator returned by <code class="docutils literal notranslate"><span class="pre">:siter</span></code> for their main loop, with their <code class="docutils literal notranslate"><span class="pre">range</span></code>, <code class="docutils literal notranslate"><span class="pre">nturn</span></code> and <code class="docutils literal notranslate"><span class="pre">dir</span></code> attributes as arguments. These commands also save the iterator states in their <code class="docutils literal notranslate"><span class="pre">mflw</span></code> to allow the users to run them <code class="docutils literal notranslate"><span class="pre">nstep</span></code> by <code class="docutils literal notranslate"><span class="pre">nstep</span></code>, see commands <a class="reference internal" href="mad_cmd_survey.html"><span class="doc">survey</span></a> and <a class="reference internal" href="mad_cmd_track.html"><span class="doc">track</span></a> for details.</p>
<p>The following example shows how to access to the elements with the <code class="docutils literal notranslate"><span class="pre">:foreach</span></code> method::</p>
<div class="highlight-mad notranslate"><div class="highlight"><pre><span></span><span class="kd">local</span> <span class="n">sequence</span><span class="p">,</span> <span class="n">drift</span><span class="p">,</span> <span class="n">marker</span> <span class="kr">in</span> <span class="n">MAD</span><span class="p">.</span><span class="n">element</span>
<span class="kd">local</span> <span class="n">observed</span> <span class="kr">in</span> <span class="n">MAD</span><span class="p">.</span><span class="n">element</span><span class="p">.</span><span class="n">flags</span>
<span class="kd">local</span> <span class="n">seq</span> <span class="o">=</span> <span class="n">sequence</span> <span class="p">{</span>
<span class="n">drift</span> <span class="s1">&#39;df&#39;</span> <span class="p">{</span> <span class="n">id</span><span class="o">=</span><span class="mi">1</span> <span class="p">},</span> <span class="n">marker</span> <span class="s1">&#39;mk&#39;</span> <span class="p">{</span> <span class="n">id</span><span class="o">=</span><span class="mi">2</span> <span class="p">},</span>
<span class="n">drift</span> <span class="s1">&#39;df&#39;</span> <span class="p">{</span> <span class="n">id</span><span class="o">=</span><span class="mi">3</span> <span class="p">},</span> <span class="n">marker</span> <span class="s1">&#39;mk&#39;</span> <span class="p">{</span> <span class="n">id</span><span class="o">=</span><span class="mi">4</span> <span class="p">},</span>
<span class="n">drift</span> <span class="s1">&#39;df&#39;</span> <span class="p">{</span> <span class="n">id</span><span class="o">=</span><span class="mi">5</span> <span class="p">},</span> <span class="n">marker</span> <span class="s1">&#39;mk&#39;</span> <span class="p">{</span> <span class="n">id</span><span class="o">=</span><span class="mi">6</span> <span class="p">},</span>
<span class="p">}</span>

<span class="kd">local</span> <span class="n">act</span> <span class="o">=</span> <span class="o">\</span><span class="n">e</span> <span class="o">-&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="n">e</span><span class="p">.</span><span class="n">id</span><span class="p">)</span>
<span class="n">seq</span><span class="p">:</span><span class="n">foreach</span><span class="p">(</span><span class="n">act</span><span class="p">,</span> <span class="s2">&quot;df[2]/mk[3]&quot;</span><span class="p">)</span>
<span class="c1">-- display:</span>
<span class="c1">--          df   3</span>
<span class="c1">--          mk   4</span>
<span class="c1">--          df   5</span>
<span class="c1">--          mk   6</span>

<span class="n">seq</span><span class="p">:</span><span class="n">foreach</span><span class="p">{</span><span class="n">action</span><span class="o">=</span><span class="n">act</span><span class="p">,</span> <span class="n">range</span><span class="o">=</span><span class="s2">&quot;df[2]/mk[3]&quot;</span><span class="p">,</span> <span class="n">class</span><span class="o">=</span><span class="n">marker</span><span class="p">}</span>
<span class="c1">-- display: markers at ids 4 and 6</span>
<span class="n">seq</span><span class="p">:</span><span class="n">foreach</span><span class="p">{</span><span class="n">action</span><span class="o">=</span><span class="n">act</span><span class="p">,</span> <span class="n">pattern</span><span class="o">=</span><span class="s2">&quot;^[^$]&quot;</span><span class="p">}</span>
<span class="c1">-- display: all elements except $start and $end markers</span>
<span class="n">seq</span><span class="p">:</span><span class="n">foreach</span><span class="p">{</span><span class="n">action</span><span class="o">=\</span><span class="n">e</span> <span class="o">-&gt;</span> <span class="n">e</span><span class="p">:</span><span class="nb">select</span><span class="p">(</span><span class="n">observed</span><span class="p">),</span> <span class="n">pattern</span><span class="o">=</span><span class="s2">&quot;mk&quot;</span><span class="p">}</span>
<span class="c1">-- same as: seq:select(observed, {pattern=&quot;mk&quot;})</span>

<span class="kd">local</span> <span class="n">act</span> <span class="o">=</span> <span class="o">\</span><span class="n">e</span> <span class="o">-&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="n">e</span><span class="p">.</span><span class="n">id</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span><span class="n">is_observed</span><span class="p">())</span>
<span class="n">seq</span><span class="p">:</span><span class="n">foreach</span><span class="p">{</span><span class="n">action</span><span class="o">=</span><span class="n">act</span><span class="p">,</span> <span class="n">range</span><span class="o">=</span><span class="s2">&quot;#s/#e&quot;</span><span class="p">}</span>
<span class="c1">-- display:</span>
<span class="c1">--          $start   nil  false</span>
<span class="c1">--          df       1    false</span>
<span class="c1">--          mk       2    true</span>
<span class="c1">--          df       3    false</span>
<span class="c1">--          mk       4    true</span>
<span class="c1">--          df       5    false</span>
<span class="c1">--          mk       6    true</span>
<span class="c1">--          $end     nil  true</span>
</pre></div>
</div>
</section>
<section id="examples">
<h2>Examples<a class="headerlink" href="#examples" title="Permalink to this heading">¶</a></h2>
<section id="fodo-cell">
<h3>FODO cell<a class="headerlink" href="#fodo-cell" title="Permalink to this heading">¶</a></h3>
<p>The following example shows how to build a very simple FODO cell and an arc made of 10 FODO cells.</p>
<div class="highlight-mad notranslate"><div class="highlight"><pre><span></span><span class="kd">local</span> <span class="n">sequence</span><span class="p">,</span> <span class="n">sbend</span><span class="p">,</span> <span class="n">quadrupole</span><span class="p">,</span> <span class="n">sextupole</span><span class="p">,</span> <span class="n">hkicker</span><span class="p">,</span> <span class="n">vkicker</span><span class="p">,</span> <span class="n">marker</span> <span class="kr">in</span> <span class="n">MAD</span><span class="p">.</span><span class="n">element</span>
<span class="kd">local</span> <span class="n">mkf</span> <span class="o">=</span> <span class="n">marker</span> <span class="s1">&#39;mkf&#39;</span> <span class="p">{}</span>
<span class="kd">local</span> <span class="n">ang</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="nb">math.pi</span><span class="o">/</span><span class="mi">80</span>
<span class="kd">local</span> <span class="n">fodo</span> <span class="o">=</span> <span class="n">sequence</span> <span class="s1">&#39;fodo&#39;</span> <span class="p">{</span> <span class="n">refer</span><span class="o">=</span><span class="s1">&#39;entry&#39;</span><span class="p">,</span>
<span class="n">mkf</span>             <span class="p">{</span> <span class="n">at</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">shared</span><span class="o">=</span><span class="kc">true</span>      <span class="p">},</span> <span class="c1">-- mark the start of the fodo</span>
<span class="n">quadrupole</span> <span class="s1">&#39;qf&#39;</span> <span class="p">{</span> <span class="n">at</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">l</span><span class="o">=</span><span class="mi">1</span>  <span class="p">,</span> <span class="n">k1</span><span class="o">=</span><span class="mf">0.3</span>    <span class="p">},</span>
<span class="n">sextupole</span>  <span class="s1">&#39;sf&#39;</span> <span class="p">{</span>       <span class="n">l</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">k2</span><span class="o">=</span><span class="mi">0</span>      <span class="p">},</span>
<span class="n">hkicker</span>    <span class="s1">&#39;hk&#39;</span> <span class="p">{</span>       <span class="n">l</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">kick</span><span class="o">=</span><span class="mi">0</span>    <span class="p">},</span>
<span class="n">sbend</span>      <span class="s1">&#39;mb&#39;</span> <span class="p">{</span> <span class="n">at</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">l</span><span class="o">=</span><span class="mi">2</span>  <span class="p">,</span> <span class="n">angle</span><span class="o">=</span><span class="n">ang</span> <span class="p">},</span>

<span class="n">quadrupole</span> <span class="s1">&#39;qd&#39;</span> <span class="p">{</span> <span class="n">at</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">l</span><span class="o">=</span><span class="mi">1</span>  <span class="p">,</span> <span class="n">k1</span><span class="o">=-</span><span class="mf">0.3</span>   <span class="p">},</span>
<span class="n">sextupole</span>  <span class="s1">&#39;sd&#39;</span> <span class="p">{</span>       <span class="n">l</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">k2</span><span class="o">=</span><span class="mi">0</span>      <span class="p">},</span>
<span class="n">vkicker</span>    <span class="s1">&#39;vk&#39;</span> <span class="p">{</span>       <span class="n">l</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">kick</span><span class="o">=</span><span class="mi">0</span>    <span class="p">},</span>
<span class="n">sbend</span>      <span class="s1">&#39;mb&#39;</span> <span class="p">{</span> <span class="n">at</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">l</span><span class="o">=</span><span class="mi">2</span>  <span class="p">,</span> <span class="n">angle</span><span class="o">=</span><span class="n">ang</span> <span class="p">},</span>
<span class="p">}</span>
<span class="kd">local</span> <span class="n">arc</span> <span class="o">=</span> <span class="n">sequence</span> <span class="s1">&#39;arc&#39;</span> <span class="p">{</span> <span class="n">refer</span><span class="o">=</span><span class="s1">&#39;entry&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="o">*</span><span class="n">fodo</span> <span class="p">}</span>
<span class="n">fodo</span><span class="p">:</span><span class="n">dumpseq</span><span class="p">()</span> <span class="p">;</span> <span class="nb">print</span><span class="p">(</span><span class="n">fodo</span><span class="p">.</span><span class="n">mkf</span><span class="p">,</span> <span class="n">mkf</span><span class="p">)</span>
</pre></div>
</div>
<p>Display:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>sequence: fodo, l=9
idx  kind          name          l          dl       spos       upos    uds
001  marker        $start  0.000       0       0.000      0.000   0.000
002  marker        mkf     0.000       0       0.000      0.000   0.000
003  quadrupole    qf      1.000       0       0.000      0.000   0.000
004  sextupole     sf      0.300       0       1.000      1.000   0.000
005  hkicker       hk      0.200       0       1.300      1.300   0.000
006  sbend         mb      2.000       0       2.000      2.000   0.000
007  quadrupole    qd      1.000       0       5.000      5.000   0.000
008  sextupole     sd      0.300       0       6.000      6.000   0.000
009  vkicker       vk      0.200       0       6.300      6.300   0.000
010  sbend         mb      2.000       0       7.000      7.000   0.000
011  marker        $end    0.000       0       9.000      9.000   0.000
marker : &#39;mkf&#39; 0x01015310e8  marker: &#39;mkf&#39; 0x01015310e8 -- same marker
</pre></div>
</div>
</section>
<section id="sps-compact-description">
<h3>SPS compact description<a class="headerlink" href="#sps-compact-description" title="Permalink to this heading">¶</a></h3>
<p>The following dummy example shows a compact definition of the SPS mixing elements, beam lines and sequence definitions.
The elements are zero-length, so the lattice is too.</p>
<div class="highlight-mad notranslate"><div class="highlight"><pre><span></span><span class="kd">local</span> <span class="n">drift</span><span class="p">,</span> <span class="n">sbend</span><span class="p">,</span> <span class="n">quadrupole</span><span class="p">,</span> <span class="n">bline</span><span class="p">,</span> <span class="n">sequence</span> <span class="kr">in</span> <span class="n">MAD</span><span class="p">.</span><span class="n">element</span>

<span class="c1">-- elements (empty!)</span>
<span class="kd">local</span> <span class="n">ds</span> <span class="o">=</span> <span class="n">drift</span>      <span class="s1">&#39;ds&#39;</span> <span class="p">{}</span>
<span class="kd">local</span> <span class="n">dl</span> <span class="o">=</span> <span class="n">drift</span>      <span class="s1">&#39;dl&#39;</span> <span class="p">{}</span>
<span class="kd">local</span> <span class="n">dm</span> <span class="o">=</span> <span class="n">drift</span>      <span class="s1">&#39;dm&#39;</span> <span class="p">{}</span>
<span class="kd">local</span> <span class="n">b1</span> <span class="o">=</span> <span class="n">sbend</span>      <span class="s1">&#39;b1&#39;</span> <span class="p">{}</span>
<span class="kd">local</span> <span class="n">b2</span> <span class="o">=</span> <span class="n">sbend</span>      <span class="s1">&#39;b2&#39;</span> <span class="p">{}</span>
<span class="kd">local</span> <span class="n">qf</span> <span class="o">=</span> <span class="n">quadrupole</span> <span class="s1">&#39;qf&#39;</span> <span class="p">{}</span>
<span class="kd">local</span> <span class="n">qd</span> <span class="o">=</span> <span class="n">quadrupole</span> <span class="s1">&#39;qd&#39;</span> <span class="p">{}</span>

<span class="c1">-- subsequences</span>
<span class="kd">local</span> <span class="n">pf</span>  <span class="o">=</span> <span class="n">bline</span> <span class="s1">&#39;pf&#39;</span>  <span class="p">{</span><span class="n">qf</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">b1</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">b2</span><span class="p">,</span><span class="n">ds</span><span class="p">}</span>           <span class="c1">-- #: 6</span>
<span class="kd">local</span> <span class="n">pd</span>  <span class="o">=</span> <span class="n">bline</span> <span class="s1">&#39;pd&#39;</span>  <span class="p">{</span><span class="n">qd</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">b2</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">b1</span><span class="p">,</span><span class="n">ds</span><span class="p">}</span>           <span class="c1">-- #: 6</span>
<span class="kd">local</span> <span class="n">p24</span> <span class="o">=</span> <span class="n">bline</span> <span class="s1">&#39;p24&#39;</span> <span class="p">{</span><span class="n">qf</span><span class="p">,</span><span class="n">dm</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">b2</span><span class="p">,</span><span class="n">ds</span><span class="p">,</span><span class="n">pd</span><span class="p">}</span>          <span class="c1">-- #: 11 (5+6)</span>
<span class="kd">local</span> <span class="n">p42</span> <span class="o">=</span> <span class="n">bline</span> <span class="s1">&#39;p42&#39;</span> <span class="p">{</span><span class="n">pf</span><span class="p">,</span><span class="n">qd</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">b2</span><span class="p">,</span><span class="n">dm</span><span class="p">,</span><span class="n">ds</span><span class="p">}</span>          <span class="c1">-- #: 11 (6+5)</span>
<span class="kd">local</span> <span class="n">p00</span> <span class="o">=</span> <span class="n">bline</span> <span class="s1">&#39;p00&#39;</span> <span class="p">{</span><span class="n">qf</span><span class="p">,</span><span class="n">dl</span><span class="p">,</span><span class="n">qd</span><span class="p">,</span><span class="n">dl</span><span class="p">}</span>               <span class="c1">-- #: 4</span>
<span class="kd">local</span> <span class="n">p44</span> <span class="o">=</span> <span class="n">bline</span> <span class="s1">&#39;p44&#39;</span> <span class="p">{</span><span class="n">pf</span><span class="p">,</span><span class="n">pd</span><span class="p">}</span>                     <span class="c1">-- #: 12 (6+6)</span>
<span class="kd">local</span> <span class="n">insert</span> <span class="o">=</span> <span class="n">bline</span> <span class="s1">&#39;insert&#39;</span> <span class="p">{</span><span class="n">p24</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">p00</span><span class="p">,</span><span class="n">p42</span><span class="p">}</span>       <span class="c1">-- #: 30 (11+2*4+11)</span>
<span class="kd">local</span> <span class="n">super</span>  <span class="o">=</span> <span class="n">bline</span> <span class="s1">&#39;super&#39;</span>  <span class="p">{</span><span class="mi">7</span><span class="o">*</span><span class="n">p44</span><span class="p">,</span><span class="n">insert</span><span class="p">,</span><span class="mi">7</span><span class="o">*</span><span class="n">p44</span><span class="p">}</span>  <span class="c1">-- #: 198 (7*12+30+7*12)</span>

<span class="c1">-- final sequence</span>
<span class="kd">local</span> <span class="n">SPS</span> <span class="o">=</span> <span class="n">sequence</span> <span class="s1">&#39;SPS&#39;</span> <span class="p">{</span><span class="mi">6</span><span class="o">*</span><span class="n">super</span><span class="p">}</span>                <span class="c1">-- # = 1188 (6*198)</span>

<span class="c1">-- check number of elements and length</span>
<span class="nb">print</span><span class="p">(</span><span class="o">#</span><span class="n">SPS</span><span class="p">,</span> <span class="n">SPS</span><span class="p">.</span><span class="n">l</span><span class="p">)</span>  <span class="c1">-- display: 1190  0 (no element length provided)</span>
</pre></div>
</div>
</section>
<section id="installing-elements-i">
<h3>Installing elements I<a class="headerlink" href="#installing-elements-i" title="Permalink to this heading">¶</a></h3>
<p>The following example shows how to install elements and subsequences in an empty initial sequence:</p>
<div class="highlight-mad notranslate"><div class="highlight"><pre><span></span><span class="kd">local</span> <span class="n">sequence</span><span class="p">,</span> <span class="n">drift</span> <span class="kr">in</span> <span class="n">MAD</span><span class="p">.</span><span class="n">element</span>
<span class="kd">local</span> <span class="n">seq</span>   <span class="o">=</span> <span class="n">sequence</span> <span class="s2">&quot;seq&quot;</span> <span class="p">{</span> <span class="n">l</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">refer</span><span class="o">=</span><span class="s2">&quot;entry&quot;</span><span class="p">,</span> <span class="n">owner</span><span class="o">=</span><span class="kc">true</span> <span class="p">}</span>
<span class="kd">local</span> <span class="n">sseq1</span> <span class="o">=</span> <span class="n">sequence</span> <span class="s2">&quot;sseq1&quot;</span> <span class="p">{</span>
<span class="n">at</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">l</span><span class="o">=</span><span class="mi">6</span> <span class="p">,</span> <span class="n">refpos</span><span class="o">=</span><span class="s2">&quot;centre&quot;</span><span class="p">,</span> <span class="n">refer</span><span class="o">=</span><span class="s2">&quot;entry&quot;</span><span class="p">,</span>
<span class="n">drift</span> <span class="s2">&quot;df1&#39;&quot;</span> <span class="p">{</span><span class="n">l</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">at</span><span class="o">=-</span><span class="mi">4</span><span class="p">,</span> <span class="n">from</span><span class="o">=</span><span class="s2">&quot;end&quot;</span><span class="p">},</span>
<span class="n">drift</span> <span class="s2">&quot;df2&#39;&quot;</span> <span class="p">{</span><span class="n">l</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">at</span><span class="o">=-</span><span class="mi">2</span><span class="p">,</span> <span class="n">from</span><span class="o">=</span><span class="s2">&quot;end&quot;</span><span class="p">},</span>
<span class="n">drift</span> <span class="s2">&quot;df3&#39;&quot;</span> <span class="p">{</span>     <span class="n">at</span><span class="o">=</span> <span class="mi">5</span>            <span class="p">},</span>
<span class="p">}</span>
<span class="kd">local</span> <span class="n">sseq2</span> <span class="o">=</span> <span class="n">sequence</span> <span class="s2">&quot;sseq2&quot;</span> <span class="p">{</span>
<span class="n">at</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">l</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">refpos</span><span class="o">=</span><span class="s2">&quot;exit&quot;</span><span class="p">,</span> <span class="n">refer</span><span class="o">=</span><span class="s2">&quot;entry&quot;</span><span class="p">,</span>
<span class="n">drift</span> <span class="s2">&quot;df1&#39;&#39;&quot;</span> <span class="p">{</span> <span class="n">l</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">at</span><span class="o">=-</span><span class="mi">4</span><span class="p">,</span> <span class="n">from</span><span class="o">=</span><span class="s2">&quot;end&quot;</span><span class="p">},</span>
<span class="n">drift</span> <span class="s2">&quot;df2&#39;&#39;&quot;</span> <span class="p">{</span> <span class="n">l</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">at</span><span class="o">=-</span><span class="mi">2</span><span class="p">,</span> <span class="n">from</span><span class="o">=</span><span class="s2">&quot;end&quot;</span><span class="p">},</span>
<span class="n">drift</span> <span class="s2">&quot;df3&#39;&#39;&quot;</span> <span class="p">{</span>      <span class="n">at</span><span class="o">=</span> <span class="mi">5</span>            <span class="p">},</span>
<span class="p">}</span>
<span class="n">seq</span><span class="p">:</span><span class="n">install</span> <span class="p">{</span>
<span class="n">drift</span> <span class="s2">&quot;df1&quot;</span> <span class="p">{</span><span class="n">l</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">at</span><span class="o">=</span><span class="mi">1</span><span class="p">},</span>
<span class="n">sseq1</span><span class="p">,</span> <span class="n">sseq2</span><span class="p">,</span>
<span class="n">drift</span> <span class="s2">&quot;df2&quot;</span> <span class="p">{</span><span class="n">l</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">at</span><span class="o">=</span><span class="mi">15</span><span class="p">},</span>
<span class="p">}</span> <span class="p">:</span><span class="n">dumpseq</span><span class="p">()</span>
</pre></div>
</div>
<p>Display:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>sequence: seq, l=16
idx  kind          name       l          dl       spos       upos    uds
001  marker        $start*    0.000       0       0.000      0.000   0.000
002  drift         df1        1.000       0       1.000      1.000   0.000
003  drift         df1&#39;       1.000       0       4.000      4.000   0.000
004  drift         df2&#39;       1.000       0       6.000      6.000   0.000
005  drift         df3&#39;       0.000       0       7.000      7.000   0.000
006  drift         df1&#39;&#39;      1.000       0      10.000     10.000   0.000
007  drift         df2&#39;&#39;      1.000       0      12.000     12.000   0.000
008  drift         df3&#39;&#39;      0.000       0      13.000     13.000   0.000
009  drift         df2        1.000       0      15.000     15.000   0.000
010  marker        $end       0.000       0      16.000     16.000   0.000
</pre></div>
</div>
</section>
<section id="installing-elements-ii">
<h3>Installing elements II<a class="headerlink" href="#installing-elements-ii" title="Permalink to this heading">¶</a></h3>
<p>The following more complex example shows how to install elements and subsequences in a sequence using a selection and the packed form for arguments:</p>
<div class="highlight-mad notranslate"><div class="highlight"><pre><span></span><span class="kd">local</span> <span class="n">mk</span>   <span class="o">=</span> <span class="n">marker</span>   <span class="s2">&quot;mk&quot;</span>  <span class="p">{</span> <span class="p">}</span>
<span class="kd">local</span> <span class="n">seq</span>  <span class="o">=</span> <span class="n">sequence</span> <span class="s2">&quot;seq&quot;</span> <span class="p">{</span> <span class="n">l</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">refer</span><span class="o">=</span><span class="s2">&quot;entry&quot;</span><span class="p">,</span>
<span class="n">mk</span> <span class="s2">&quot;mk1&quot;</span> <span class="p">{</span> <span class="n">at</span> <span class="o">=</span> <span class="mi">2</span> <span class="p">},</span>
<span class="n">mk</span> <span class="s2">&quot;mk2&quot;</span> <span class="p">{</span> <span class="n">at</span> <span class="o">=</span> <span class="mi">4</span> <span class="p">},</span>
<span class="n">mk</span> <span class="s2">&quot;mk3&quot;</span> <span class="p">{</span> <span class="n">at</span> <span class="o">=</span> <span class="mi">8</span> <span class="p">},</span>
<span class="p">}</span>
<span class="kd">local</span> <span class="n">sseq</span> <span class="o">=</span> <span class="n">sequence</span> <span class="s2">&quot;sseq&quot;</span> <span class="p">{</span> <span class="n">l</span> <span class="o">=</span> <span class="mi">3</span> <span class="p">,</span> <span class="n">at</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="n">refer</span><span class="o">=</span><span class="s2">&quot;entry&quot;</span><span class="p">,</span>
<span class="n">drift</span> <span class="s2">&quot;df1&#39;&quot;</span> <span class="p">{</span> <span class="n">l</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">at</span> <span class="o">=</span> <span class="mi">0</span> <span class="p">},</span>
<span class="n">drift</span> <span class="s2">&quot;df2&#39;&quot;</span> <span class="p">{</span> <span class="n">l</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">at</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">},</span>
<span class="n">drift</span> <span class="s2">&quot;df3&#39;&quot;</span> <span class="p">{</span> <span class="n">l</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">at</span> <span class="o">=</span> <span class="mi">2</span> <span class="p">},</span>
<span class="p">}</span>
<span class="n">seq</span><span class="p">:</span><span class="n">install</span> <span class="p">{</span>
<span class="n">class</span>    <span class="o">=</span> <span class="n">mk</span><span class="p">,</span>
<span class="n">elements</span> <span class="o">=</span> <span class="p">{</span>
   <span class="n">drift</span> <span class="s2">&quot;df1&quot;</span> <span class="p">{</span> <span class="n">l</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">at</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">from</span><span class="o">=</span><span class="s2">&quot;selected&quot;</span> <span class="p">},</span>
   <span class="n">drift</span> <span class="s2">&quot;df2&quot;</span> <span class="p">{</span> <span class="n">l</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">at</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">,</span> <span class="n">from</span><span class="o">=</span><span class="s2">&quot;selected&quot;</span> <span class="p">},</span>
   <span class="n">drift</span> <span class="s2">&quot;df3&quot;</span> <span class="p">{</span> <span class="n">l</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">at</span> <span class="o">=</span> <span class="mf">0.3</span><span class="p">,</span> <span class="n">from</span><span class="o">=</span><span class="s2">&quot;selected&quot;</span> <span class="p">},</span>
   <span class="n">sseq</span><span class="p">,</span>
   <span class="n">drift</span> <span class="s2">&quot;df4&quot;</span> <span class="p">{</span> <span class="n">l</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">at</span> <span class="o">=</span> <span class="mi">9</span> <span class="p">},</span>
<span class="p">}</span>
<span class="p">}</span>

<span class="n">seq</span><span class="p">:</span><span class="n">dumpseq</span><span class="p">()</span>
</pre></div>
</div>
<p>Display:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>sequence: seq, l=10
idx  kind          name      l          dl       spos       upos    uds
001  marker        $start    0.000       0       0.000      0.000   0.000
002  marker        mk1       0.000       0       2.000      2.000   0.000
003  drift         df1       0.100       0       2.100      2.100   0.000
004  drift         df2       0.100       0       2.200      2.200   0.000
005  drift         df3       0.100       0       2.300      2.300   0.000
006  marker        mk2       0.000       0       4.000      4.000   0.000
007  drift         df1       0.100       0       4.100      4.100   0.000
008  drift         df2       0.100       0       4.200      4.200   0.000
009  drift         df3       0.100       0       4.300      4.300   0.000
010  drift         df1&#39;      1.000       0       5.000      5.000   0.000
011  drift         df2&#39;      1.000       0       6.000      6.000   0.000
012  drift         df3&#39;      1.000       0       7.000      7.000   0.000
013  marker        mk3       0.000       0       8.000      8.000   0.000
014  drift         df1       0.100       0       8.100      8.100   0.000
015  drift         df2       0.100       0       8.200      8.200   0.000
016  drift         df3       0.100       0       8.300      8.300   0.000
017  drift         df4       1.000       0       9.000      9.000   0.000
018  marker        $end      0.000       0      10.000     10.000   0.000
</pre></div>
</div>
<p class="rubric">Footnotes</p>
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="f1" role="note">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id1">1</a><span class="fn-bracket">]</span></span>
<p>This is equivalent to the MAD-X <code class="docutils literal notranslate"><span class="pre">bv</span></code> flag.</p>
</aside>
<aside class="footnote brackets" id="f2" role="note">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id2">2</a><span class="fn-bracket">]</span></span>
<p>For example, the <code class="docutils literal notranslate"><span class="pre">:remove</span></code> method needs <code class="docutils literal notranslate"><span class="pre">not=true</span></code> to <em>not</em> remove all elements if no selector is provided.</p>
</aside>
<aside class="footnote brackets" id="f3" role="note">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id3">3</a><span class="fn-bracket">]</span></span>
<p>Updating directly the positions attributes of an element has no effect.</p>
</aside>
<aside class="footnote brackets" id="f4" role="note">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id4">4</a><span class="fn-bracket">]</span></span>
<p>An <em>iterable</em> supports the length operator <code class="docutils literal notranslate"><span class="pre">#</span></code>, the indexing operator <code class="docutils literal notranslate"><span class="pre">[]</span></code> and generic <code class="docutils literal notranslate"><span class="pre">for</span></code> loops with <code class="docutils literal notranslate"><span class="pre">ipairs</span></code>.</p>
</aside>
<aside class="footnote brackets" id="f5" role="note">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id5">5</a><span class="fn-bracket">]</span></span>
<p>MAD-NG does not have a MAD-X like <code class="docutils literal notranslate"><span class="pre">&quot;USE&quot;</span></code> command to finalize this computation.</p>
</aside>
</aside>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="mad_gen_elements.html" class="btn btn-neutral float-left" title="Elements" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="mad_gen_mtable.html" class="btn btn-neutral float-right" title="MTables" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Laurent Deniau.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>