

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Welcome to LuaUnit’s documentation! &mdash; LuaUnit 1.6 documentation</title>
  

  
  

  

  
  
    

  

  
  

  
    <link rel="stylesheet" href="https://media.readthedocs.org/css/sphinx_rtd_theme.css" type="text/css" />
  

  
    <link rel="top" title="LuaUnit 1.6 documentation" href="#"/> 

  
  <script src="_static/js/modernizr.min.js"></script>


<!-- RTD Extra Head -->

<!-- 
Always link to the latest version, as canonical.
http://docs.readthedocs.org/en/latest/canonical.html
-->
<link rel="canonical" href="http://luaunit.readthedocs.io/en/latest/" />

<link rel="stylesheet" href="https://media.readthedocs.org/css/readthedocs-doc-embed.css" type="text/css" />

<script type="text/javascript" src="_static/readthedocs-data.js"></script>

<!-- Add page-specific data, which must exist in the page js, not global -->
<script type="text/javascript">
READTHEDOCS_DATA['page'] = 'index'
</script>

<script type="text/javascript" src="_static/readthedocs-dynamic-include.js"></script>

<!-- end RTD <extrahead> --></head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="#" class="icon icon-home"> LuaUnit
          

          
          </a>

          
            
            
            
              <div class="version">
                latest
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="simple">
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="#">LuaUnit</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          





<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="#">Docs</a> &raquo;</li>
      
    <li>Welcome to LuaUnit&#8217;s documentation!</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="https://github.com/bluebird75/luaunit/blob/master/doc/index.rst" class="fa fa-github"> Edit on GitHub</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="welcome-to-luaunit-s-documentation">
<h1>Welcome to LuaUnit&#8217;s documentation!<a class="headerlink" href="#welcome-to-luaunit-s-documentation" title="Permalink to this headline">¶</a></h1>
<div class="toctree-wrapper compound">
<ul class="simple">
</ul>
</div>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>LuaUnit is a unit-testing framework for Lua. It allows you
to write test functions and test classes with test methods, combined with
setup/teardown functionality. A wide range of assertions are supported.</p>
<p>LuaUnit supports several output format, like Junit or TAP, for easier integration
into Continuous Integration platforms (Jenkins, Maven, ...) . The integrated command-line
options provide a flexible interface to select tests by name or patterns, control output
format, set verbosity, ...</p>
<div class="section" id="platform-support">
<h3>Platform support<a class="headerlink" href="#platform-support" title="Permalink to this headline">¶</a></h3>
<p>LuaUnit works with Lua 5.1, 5.2, 5.3 and luajit (v1 and v2.1). It is tested on Windows Seven, Windows Server 2003 and Ubuntu 14.04 (see
continuous build results on <a class="reference external" href="https://travis-ci.org/bluebird75/luaunit">Travis-CI</a>  and <a class="reference external" href="https://ci.appveyor.com/project/bluebird75/luaunit/history">AppVeyor</a> ) and should work on all platforms supported by lua.
It has no other dependency than lua itself.</p>
<p>LuaUnit works with Lua 5.1, LuaJIT 2.0, LuaJIT 2.1 beta, Lua 5.2 and Lua 5.3 . It is tested on Windows Seven, Windows Server 2012 R2 (x64) and Ubuntu 14.04 (see
continuous build results on <a class="reference external" href="https://travis-ci.org/bluebird75/luaunit">Travis-CI</a>  and <a class="reference external" href="https://ci.appveyor.com/project/bluebird75/luaunit/history">AppVeyor</a>  ) and should work on all platforms supported by Lua.
It has no other dependency than Lua itself.</p>
<p>LuaUnit is packed into a single-file. To make start using it, just add the file to your project. Other installation methods are described in the <a class="reference external" href="https://github.com/bluebird75/luaunit">README.md</a> file.</p>
<p>LuaUnit is maintained on github:
<a class="reference external" href="https://github.com/bluebird75/luaunit">https://github.com/bluebird75/luaunit</a></p>
<p>It is released under the BSD license.</p>
</div>
<div class="section" id="luaunit-development">
<h3>LuaUnit development<a class="headerlink" href="#luaunit-development" title="Permalink to this headline">¶</a></h3>
<p>See <a class="reference internal" href="#developing-luaunit"><span>Developing LuaUnit</span></a></p>
</div>
<div class="section" id="version-and-changelog">
<h3>Version and Changelog<a class="headerlink" href="#version-and-changelog" title="Permalink to this headline">¶</a></h3>
<p>This documentation describes the functionality of LuaUnit v3.2 .</p>
<div class="section" id="new-in-version-3-2-in-progress">
<h4>New in version 3.2 - (in progress)<a class="headerlink" href="#new-in-version-3-2-in-progress" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>distinguish between failures (failed assertion) and errors</li>
<li>Support for new versions: Lua 5.3 and LuaJIT (2.0, 2.1 beta)</li>
<li>Validation of all lua versions on Travis CI and AppVeyor</li>
<li>Compatibility layer with forked luaunit v2.x added</li>
<li>added documentation about development process</li>
<li>improved support for table containing keys of type table</li>
<li>small bug fixes, several internal improvements</li>
</ul>
</div>
<div class="section" id="new-in-version-3-1-10-mar-2015">
<h4>New in version 3.1 - 10. Mar 2015<a class="headerlink" href="#new-in-version-3-1-10-mar-2015" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>luaunit no longer pollutes global namespace, unless defining EXPORT_ASSERT_TO_GLOBALS to true</li>
<li>fixes and validation of JUnit XML generation</li>
<li>strip luaunit internal information from stacktrace</li>
<li>general improvements of test results with duration and other details</li>
<li>improve printing for tables, with an option to always print table id</li>
<li>fix printing of recursive tables</li>
</ul>
<p><strong>Important note when upgrading to version 3.1</strong> : assertions functions are
no longer exported directly to the global namespace. See <a class="reference internal" href="#luaunit-global-asserts"><span>Enabling global or module-level functions</span></a></p>
</div>
<div class="section" id="new-in-version-3-0-9-oct-2014">
<h4>New in version 3.0 - 9. Oct 2014<a class="headerlink" href="#new-in-version-3-0-9-oct-2014" title="Permalink to this headline">¶</a></h4>
<p>Because LuaUnit was forked and released as some 2.x version, version number
is now jumping to 3.0 .</p>
<ul class="simple">
<li>full documentation available in text, html and pdf at read-the-docs.org</li>
<li>new output format: JUnit, compatible with Bamboo and other CI platforms</li>
<li>much better table assertions</li>
<li>new assertions for strings, with patterns and case insensitivity: assertStrContains,
assertNotStrContains, assertNotStrIContains, assertStrIContains, assertStrMatches</li>
<li>new assertions for floats: assertAlmostEquals, assertNotAlmostEquals</li>
<li>type assertions: assertIsString, assertIsNumber, ...</li>
<li>error assertions: assertErrorMsgEquals, assertErrorMsgContains, assertErrorMsgMatches</li>
<li>improved error messages for several assertions</li>
<li>command-line options to select test, control output type and verbosity</li>
</ul>
</div>
<div class="section" id="new-in-version-1-5-8-nov-2012">
<h4>New in version 1.5 - 8. Nov 2012<a class="headerlink" href="#new-in-version-1-5-8-nov-2012" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>compatibility with Lua 5.1 and 5.2</li>
<li>better object model internally</li>
<li>a lot more of internal tests</li>
<li>several internal bug fixes</li>
<li>make it easy to customize the test output</li>
<li>running test functions no longer requires a wrapper</li>
<li>several level of verbosity</li>
</ul>
</div>
<div class="section" id="new-in-version-1-4-26-jul-2012">
<h4>New in version 1.4 - 26. Jul 2012<a class="headerlink" href="#new-in-version-1-4-26-jul-2012" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>switch from X11 to more popular BSD license</li>
<li>add TAP output format for integration into Jenkins</li>
<li>official repository now on github</li>
</ul>
</div>
<div class="section" id="new-in-version-1-3-30-oct-2007">
<h4>New in version 1.3 - 30. Oct 2007<a class="headerlink" href="#new-in-version-1-3-30-oct-2007" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>port to lua 5.1</li>
<li>iterate over the test classes, methods and functions in the alphabetical order</li>
<li>change the default order of expected, actual in assertEquals (adjustable with USE_EXPECTED_ACTUAL_IN_ASSERT_EQUALS).</li>
</ul>
</div>
<div class="section" id="version-1-2-13-jun-2005">
<h4>Version 1.2 - 13. Jun 2005<a class="headerlink" href="#version-1-2-13-jun-2005" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>first public release</li>
</ul>
</div>
<div class="section" id="version-1-1">
<h4>Version 1.1<a class="headerlink" href="#version-1-1" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>move global variables to internal variables</li>
<li>assertion order is configurable between expected/actual or actual/expected</li>
<li>new assertion to check that a function call returns an error</li>
<li>display the calling stack when an error is spotted</li>
<li>two verbosity level, like in python unittest</li>
</ul>
</div>
</div>
</div>
<div class="section" id="getting-started">
<h2>Getting started<a class="headerlink" href="#getting-started" title="Permalink to this headline">¶</a></h2>
<div class="section" id="setting-up-your-test-script">
<h3>Setting up your test script<a class="headerlink" href="#setting-up-your-test-script" title="Permalink to this headline">¶</a></h3>
<p>To get started, create your file <em>test_something.lua</em> .</p>
<p>The script should import LuaUnit:</p>
<div class="highlight-lua"><div class="highlight"><pre><span></span><span class="n">luaunit</span> <span class="o">=</span> <span class="nb">require</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">luaunit&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The last line executes your script with LuaUnit and exit with the
proper error code:</p>
<div class="highlight-lua"><div class="highlight"><pre><span></span><span class="nb">os.exit</span><span class="p">(</span> <span class="n">luaunit</span><span class="p">.</span><span class="n">LuaUnit</span><span class="p">.</span><span class="n">run</span><span class="p">()</span> <span class="p">)</span>
</pre></div>
</div>
<p>Now, run your file with:</p>
<div class="highlight-lua"><div class="highlight"><pre><span></span><span class="n">lua</span> <span class="n">test_something</span><span class="p">.</span><span class="n">lua</span>
</pre></div>
</div>
<p>It prints something like:</p>
<div class="highlight-lua"><div class="highlight"><pre><span></span><span class="n">Ran</span> <span class="mi">0</span> <span class="n">tests</span> <span class="k">in</span> <span class="mi">0</span> <span class="n">seconds</span>
<span class="n">OK</span>
</pre></div>
</div>
<p>Now, your testing framework is in place, you can start writing tests.</p>
</div>
<div class="section" id="writing-tests">
<h3>Writing tests<a class="headerlink" href="#writing-tests" title="Permalink to this headline">¶</a></h3>
<p>LuaUnit scans all variables that start with <em>test</em> or <em>Test</em>.
If they are functions, or if they are tables that contain
functions that start with <em>test</em> or <em>Test</em>, they are run as part of the test suite.</p>
<p>So just write a function whose name starts with test. Inside test functions, use the assertions functions provided by LuaUnit, such
as <a class="reference internal" href="#assertEquals" title="assertEquals"><code class="xref py py-func docutils literal"><span class="pre">assertEquals()</span></code></a>.</p>
<p>Let&#8217;s see that in practice.</p>
<p>Suppose you want to test the following add function:</p>
<div class="highlight-lua"><div class="highlight"><pre><span></span><span class="k">function</span> <span class="nf">add</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span><span class="n">v2</span><span class="p">)</span>
    <span class="c1">-- add positive numbers</span>
    <span class="c1">-- return 0 if any of the numbers are 0</span>
    <span class="c1">-- error if any of the two numbers are negative</span>
    <span class="k">if</span> <span class="n">v1</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">v2</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="k">then</span>
        <span class="nb">error</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">Can only add positive or null numbers, received &#39;</span><span class="o">..</span><span class="n">v1</span><span class="o">..</span><span class="s1">&#39;</span><span class="s"> and &#39;</span><span class="o">..</span><span class="n">v2</span><span class="p">)</span>
    <span class="k">end</span>
    <span class="k">if</span> <span class="n">v1</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">v2</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">then</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="k">end</span>
    <span class="k">return</span> <span class="n">v1</span><span class="o">+</span><span class="n">v2</span>
<span class="k">end</span>
</pre></div>
</div>
<p>You write the following tests:</p>
<div class="highlight-lua"><div class="highlight"><pre><span></span><span class="k">function</span> <span class="nf">testAddPositive</span><span class="p">()</span>
    <span class="n">luaunit</span><span class="p">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">add</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="mi">2</span><span class="p">)</span>
<span class="k">end</span>

<span class="k">function</span> <span class="nf">testAddZero</span><span class="p">()</span>
    <span class="n">luaunit</span><span class="p">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">add</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">luaunit</span><span class="p">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">add</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">luaunit</span><span class="p">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">add</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="mi">0</span><span class="p">)</span>
<span class="k">end</span>
</pre></div>
</div>
<p><a class="reference internal" href="#assertEquals" title="assertEquals"><code class="xref py py-func docutils literal"><span class="pre">assertEquals()</span></code></a> is the most common used assertion function. It simply
verifies that both argument are equals, in the order actual value, expected value.</p>
<p>Rerun your test script (-v is to activate a more verbose output)</p>
<div class="highlight-lua"><div class="highlight"><pre><span></span><span class="n">lua</span> <span class="n">test_something</span><span class="p">.</span><span class="n">lua</span> <span class="o">-</span><span class="n">v</span>
</pre></div>
</div>
<p>It now prints:</p>
<div class="highlight-lua"><div class="highlight"><pre><span></span><span class="n">Started</span> <span class="n">on</span> <span class="mi">03</span><span class="o">/</span><span class="mi">10</span><span class="o">/</span><span class="mi">15</span> <span class="mi">16</span><span class="p">:</span><span class="mi">45</span><span class="p">:</span><span class="mi">41</span>
    <span class="n">TestAdd</span><span class="p">.</span><span class="n">testAddPositive</span> <span class="o">...</span> <span class="n">Ok</span>
    <span class="n">TestAdd</span><span class="p">.</span><span class="n">testAddZero</span> <span class="o">...</span> <span class="n">Ok</span>
<span class="o">=========================================================</span>
<span class="n">Ran</span> <span class="mi">2</span> <span class="n">tests</span> <span class="k">in</span> <span class="mf">0.010</span> <span class="n">seconds</span>
<span class="n">OK</span>
</pre></div>
</div>
<p>You always have:</p>
<ul class="simple">
<li>the date at which the test suite was started</li>
<li>the group to which the function belongs (usually, the name of the function table, and <em>&lt;TestFunctions&gt;</em> for all direct test functions)</li>
<li>the name of the function being executed</li>
<li>a report at the end, with number of executed test, number of non selected tests, number of failures and duration.</li>
</ul>
<p>You also want to test that when the function receives negative numbers, it generates an error. Use
<a class="reference internal" href="#assertError" title="assertError"><code class="xref py py-func docutils literal"><span class="pre">assertError()</span></code></a> or even better, <a class="reference internal" href="#assertErrorMsgContains" title="assertErrorMsgContains"><code class="xref py py-func docutils literal"><span class="pre">assertErrorMsgContains()</span></code></a> to also validate the content
of the error message. There are other types or error checking functions, see <a class="reference internal" href="#assert-error"><span>Error assertions</span></a> . Here
we use <a class="reference internal" href="#assertErrorMsgContains" title="assertErrorMsgContains"><code class="xref py py-func docutils literal"><span class="pre">assertErrorMsgContains()</span></code></a> . First argument is the expected message, then the function to call
and the optional arguments:</p>
<div class="highlight-lua"><div class="highlight"><pre><span></span><span class="k">function</span> <span class="nf">testAddError</span><span class="p">()</span>
    <span class="n">luaunit</span><span class="p">.</span><span class="n">assertErrorMsgContains</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">Can only add positive or null numbers, received 2 and -3&#39;</span><span class="p">,</span> <span class="n">add</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">)</span>
<span class="k">end</span>
</pre></div>
</div>
<p>Now, suppose we also have the following function to test:</p>
<div class="highlight-lua"><div class="highlight"><pre><span></span><span class="k">function</span> <span class="nf">adder</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
    <span class="c1">-- return a function that adds v to its argument using add</span>
    <span class="k">function</span> <span class="nf">closure</span><span class="p">(</span> <span class="n">x</span> <span class="p">)</span> <span class="k">return</span> <span class="n">x</span><span class="o">+</span><span class="n">v</span> <span class="k">end</span>
    <span class="k">return</span> <span class="n">closure</span>
<span class="k">end</span>
</pre></div>
</div>
<p>We want to test the type of the value returned by adder and its behavior. LuaUnit
provides assertion for type testing (see <a class="reference internal" href="#assert-type"><span>Type assertions</span></a>). In this case, we use
<a class="reference internal" href="#assertIsFunction" title="assertIsFunction"><code class="xref py py-func docutils literal"><span class="pre">assertIsFunction()</span></code></a>:</p>
<div class="highlight-lua"><div class="highlight"><pre><span></span><span class="k">function</span> <span class="nf">testAdder</span><span class="p">()</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">adder</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">luaunit</span><span class="p">.</span><span class="n">assertIsFunction</span><span class="p">(</span> <span class="n">f</span> <span class="p">)</span>
    <span class="n">luaunit</span><span class="p">.</span><span class="n">assertEquals</span><span class="p">(</span> <span class="n">f</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="mi">5</span> <span class="p">)</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="section" id="grouping-tests-setup-teardown-functionality">
<h3>Grouping tests, setup/teardown functionality<a class="headerlink" href="#grouping-tests-setup-teardown-functionality" title="Permalink to this headline">¶</a></h3>
<p>When the number of tests starts to grow, you usually organise them
into separate groups. You can do that with LuaUnit by putting them
inside a table (whose name must start with <em>Test</em> or <em>test</em> ).</p>
<p>For example, assume we have a second function to test:</p>
<div class="highlight-lua"><div class="highlight"><pre><span></span><span class="k">function</span> <span class="nf">div</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span><span class="n">v2</span><span class="p">)</span>
    <span class="c1">-- divide positive numbers</span>
    <span class="c1">-- return 0 if any of the numbers are 0</span>
    <span class="c1">-- error if any of the two numbers are negative</span>
    <span class="k">if</span> <span class="n">v1</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">v2</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="k">then</span>
        <span class="nb">error</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">Can only divide positive or null numbers, received &#39;</span><span class="o">..</span><span class="n">v1</span><span class="o">..</span><span class="s1">&#39;</span><span class="s"> and &#39;</span><span class="o">..</span><span class="n">v2</span><span class="p">)</span>
    <span class="k">end</span>
    <span class="k">if</span> <span class="n">v1</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">v2</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">then</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="k">end</span>
    <span class="k">return</span> <span class="n">v1</span><span class="o">/</span><span class="n">v2</span>
<span class="k">end</span>
</pre></div>
</div>
<p>We move the tests related to the function add into their own table:</p>
<div class="highlight-lua"><div class="highlight"><pre><span></span><span class="n">TestAdd</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">function</span> <span class="nf">TestAdd</span><span class="p">:</span><span class="n">testAddPositive</span><span class="p">()</span>
        <span class="n">luaunit</span><span class="p">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">add</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="k">function</span> <span class="nf">TestAdd</span><span class="p">:</span><span class="n">testAddZero</span><span class="p">()</span>
        <span class="n">luaunit</span><span class="p">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">add</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">luaunit</span><span class="p">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">add</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">luaunit</span><span class="p">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">add</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="k">function</span> <span class="nf">TestAdd</span><span class="p">:</span><span class="n">testAddError</span><span class="p">()</span>
        <span class="n">luaunit</span><span class="p">.</span><span class="n">assertErrorMsgContains</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">Can only add positive or null numbers, received 2 and -3&#39;</span><span class="p">,</span> <span class="n">add</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="k">function</span> <span class="nf">TestAdd</span><span class="p">:</span><span class="n">testAdder</span><span class="p">()</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">adder</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">luaunit</span><span class="p">.</span><span class="n">assertIsFunction</span><span class="p">(</span> <span class="n">f</span> <span class="p">)</span>
        <span class="n">luaunit</span><span class="p">.</span><span class="n">assertEquals</span><span class="p">(</span> <span class="n">f</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="mi">5</span> <span class="p">)</span>
    <span class="k">end</span>
<span class="c1">-- end of table TestAdd</span>
</pre></div>
</div>
<p>Then we create a second set of tests for div:</p>
<div class="highlight-lua"><div class="highlight"><pre><span></span><span class="n">TestDiv</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">function</span> <span class="nf">TestDiv</span><span class="p">:</span><span class="n">testDivPositive</span><span class="p">()</span>
        <span class="n">luaunit</span><span class="p">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">div</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="k">function</span> <span class="nf">TestDiv</span><span class="p">:</span><span class="n">testDivZero</span><span class="p">()</span>
        <span class="n">luaunit</span><span class="p">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">div</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">luaunit</span><span class="p">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">div</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">luaunit</span><span class="p">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">div</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="k">function</span> <span class="nf">TestDiv</span><span class="p">:</span><span class="n">testDivError</span><span class="p">()</span>
        <span class="n">luaunit</span><span class="p">.</span><span class="n">assertErrorMsgContains</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">Can only divide positive or null numbers, received 2 and -3&#39;</span><span class="p">,</span> <span class="n">div</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">)</span>
    <span class="k">end</span>
<span class="c1">-- end of table TestDiv</span>
</pre></div>
</div>
<p>Execution of the test suite now looks like this:</p>
<div class="highlight-lua"><div class="highlight"><pre><span></span><span class="n">Started</span> <span class="n">on</span> <span class="mi">03</span><span class="o">/</span><span class="mi">10</span><span class="o">/</span><span class="mi">15</span> <span class="mi">16</span><span class="p">:</span><span class="mi">47</span><span class="p">:</span><span class="mi">33</span>
    <span class="n">TestAdd</span><span class="p">.</span><span class="n">testAddError</span> <span class="o">...</span> <span class="n">Ok</span>
    <span class="n">TestAdd</span><span class="p">.</span><span class="n">testAddPositive</span> <span class="o">...</span> <span class="n">Ok</span>
    <span class="n">TestAdd</span><span class="p">.</span><span class="n">testAddZero</span> <span class="o">...</span> <span class="n">Ok</span>
    <span class="n">TestAdd</span><span class="p">.</span><span class="n">testAdder</span> <span class="o">...</span> <span class="n">Ok</span>
    <span class="n">TestDiv</span><span class="p">.</span><span class="n">testDivError</span> <span class="o">...</span> <span class="n">Ok</span>
    <span class="n">TestDiv</span><span class="p">.</span><span class="n">testDivPositive</span> <span class="o">...</span> <span class="n">Ok</span>
    <span class="n">TestDiv</span><span class="p">.</span><span class="n">testDivZero</span> <span class="o">...</span> <span class="n">Ok</span>
<span class="o">=========================================================</span>
<span class="n">Ran</span> <span class="mi">7</span> <span class="n">tests</span> <span class="k">in</span> <span class="mf">0.010</span> <span class="n">seconds</span>
<span class="n">OK</span>
</pre></div>
</div>
<p>When tests are defined in tables, you can optionally define two special
functions, <em>setUp()</em> and <em>tearDown()</em>, which will be executed
respectively before and after every test.</p>
<p>These function may be used to create specific resources for the
test being executed and cleanup the test environment.</p>
<p>For a practical example, imagine that we have a <em>log()</em> function
that writes strings to a log file on disk. The file is created
upon first usage of the function, and the filename is defined
by calling the function <em>initLog()</em>.</p>
<p>The tests for these functions would take advantage of the <em>setup/teardown</em>
functionality to prepare a log filename shared
by all tests, make sure that all tests start with a non existing
log file name, and erase the log filename after every test:</p>
<div class="highlight-lua"><div class="highlight"><pre><span></span><span class="n">TestLogger</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">function</span> <span class="nf">TestLogger</span><span class="p">:</span><span class="n">setUp</span><span class="p">()</span>
        <span class="c1">-- define the fname to use for logging</span>
        <span class="n">self</span><span class="p">.</span><span class="n">fname</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">mytmplog.log&#39;</span>
        <span class="c1">-- make sure the file does not already exists</span>
        <span class="nb">os.remove</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">fname</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="k">function</span> <span class="nf">TestLogger</span><span class="p">:</span><span class="n">testLoggerCreatesFile</span><span class="p">()</span>
        <span class="n">initLog</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">fname</span><span class="p">)</span>
        <span class="n">log</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">toto&#39;</span><span class="p">)</span>
        <span class="c1">-- make sure that our log file was created</span>
        <span class="n">f</span> <span class="o">=</span> <span class="nb">io.open</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">fname</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">r&#39;</span><span class="p">)</span>
        <span class="n">luaunit</span><span class="p">.</span><span class="n">assertNotNil</span><span class="p">(</span> <span class="n">f</span> <span class="p">)</span>
        <span class="n">f</span><span class="p">:</span><span class="n">close</span><span class="p">()</span>
    <span class="k">end</span>

    <span class="k">function</span> <span class="nf">TestLogger</span><span class="p">:</span><span class="n">tearDown</span><span class="p">()</span>
        <span class="c1">-- cleanup our log file after all tests</span>
        <span class="nb">os.remove</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">fname</span><span class="p">)</span>
    <span class="k">end</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><em>Errors generated during execution of setUp() or tearDown()
functions are considered test failures.</em></p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><em>For compatibility with luaunit v2 and other lua unit-test frameworks,
setUp() and tearDown() may also be named setup(), SetUp(), Setup(), teardown(), TearDown(), Teardown().</em></p>
</div>
</div>
<div class="section" id="using-the-command-line">
<h3>Using the command-line<a class="headerlink" href="#using-the-command-line" title="Permalink to this headline">¶</a></h3>
<p>You can control the LuaUnit execution from the command-line:</p>
<p><strong>Output format</strong></p>
<p>Choose the test output format with <code class="docutils literal"><span class="pre">-o</span></code> or <code class="docutils literal"><span class="pre">--output</span></code>. Available formats are:</p>
<ul class="simple">
<li>text: the default output format</li>
<li>nil: no output at all</li>
<li>TAP: TAP format</li>
<li>junit: output junit xml</li>
</ul>
<p>Example of non-verbose text format:</p>
<div class="highlight-lua"><div class="highlight"><pre><span></span>$ lua doc/test_something.lua
.......
Ran 7 tests in 0.002 seconds
OK
</pre></div>
</div>
<p>Example of TAP format:</p>
<div class="highlight-lua"><div class="highlight"><pre><span></span>$ lua doc/test_something.lua -o TAP
1..7
# Started on 03/10/15 16:50:09
# Starting class: TestAdd
ok     1        TestAdd.testAddError
ok     2        TestAdd.testAddPositive
ok     3        TestAdd.testAddZero
ok     4        TestAdd.testAdder
# Starting class: TestDiv
ok     5        TestDiv.testDivError
ok     6        TestDiv.testDivPositive
ok     7        TestDiv.testDivZero
# Ran 7 tests in 0.022 seconds, 7 successes, 0 failures
</pre></div>
</div>
<p><strong>List of tests to run</strong></p>
<p>You can list some test names on the command-line to run only those tests.
The name must be the exact match of either the test table, the test function or the test table
and the test method. The option may be repeated.</p>
<p>Example:</p>
<div class="highlight-lua"><div class="highlight"><pre><span></span>-- Run all TestAdd table tests and one test of TestDiv table.
$ lua doc/test_something.lua TestAdd TestDiv.testDivError -v
Started on 03/10/15 16:52:20
    TestAdd.testAddError ... Ok
    TestAdd.testAddPositive ... Ok
    TestAdd.testAddZero ... Ok
    TestAdd.testAdder ... Ok
    TestDiv.testDivError ... Ok
=========================================================
Ran 5 tests in 0.000 seconds
OK
</pre></div>
</div>
<p><strong>Filtering tests</strong></p>
<p>The most flexible approach for selecting tests to run is to use a pattern. With
<code class="docutils literal"><span class="pre">--pattern</span></code> or <code class="docutils literal"><span class="pre">-p</span></code>, you can provide a lua pattern and only the tests that contain
the pattern will actually be run.</p>
<p>Example:</p>
<div class="highlight-lua"><div class="highlight"><pre><span></span><span class="c1">-- Run all tests of zero testing and error testing</span>
<span class="c1">-- by using the magic character .</span>
<span class="n">lua</span> <span class="n">my_test_suite</span><span class="p">.</span><span class="n">lua</span> <span class="o">-</span><span class="n">v</span> <span class="o">-</span><span class="n">p</span> <span class="n">Err</span><span class="p">.</span><span class="n">r</span> <span class="o">-</span><span class="n">p</span> <span class="n">Z</span><span class="p">.</span><span class="n">ro</span>
</pre></div>
</div>
<p>For our test suite, it gives the following output:</p>
<div class="highlight-lua"><div class="highlight"><pre><span></span><span class="n">Started</span> <span class="n">on</span> <span class="mi">03</span><span class="o">/</span><span class="mi">10</span><span class="o">/</span><span class="mi">15</span> <span class="mi">16</span><span class="p">:</span><span class="mi">48</span><span class="p">:</span><span class="mi">29</span>
    <span class="n">TestAdd</span><span class="p">.</span><span class="n">testAddError</span> <span class="o">...</span> <span class="n">Ok</span>
    <span class="n">TestAdd</span><span class="p">.</span><span class="n">testAddZero</span> <span class="o">...</span> <span class="n">Ok</span>
    <span class="n">TestDiv</span><span class="p">.</span><span class="n">testDivError</span> <span class="o">...</span> <span class="n">Ok</span>
    <span class="n">TestDiv</span><span class="p">.</span><span class="n">testDivZero</span> <span class="o">...</span> <span class="n">Ok</span>
<span class="o">=========================================================</span>
<span class="n">Ran</span> <span class="mi">4</span> <span class="n">tests</span> <span class="k">in</span> <span class="mf">0.010</span> <span class="n">seconds</span>
<span class="n">OK</span> <span class="p">(</span><span class="n">ignored</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
<p>The number of tests ignored by the selection is printed, along
with the test result. The pattern can be any lua pattern. Be sure to exclude all magic
characters with % (like -+?*) and protect your pattern from the shell
interpretation by putting it in quotes.</p>
</div>
<div class="section" id="conclusion">
<h3>Conclusion<a class="headerlink" href="#conclusion" title="Permalink to this headline">¶</a></h3>
<p>You now know enough of LuaUnit to start writing your test suite. Check
the reference documentation for a complete list of
assertions, command-line options and specific behavior.</p>
</div>
</div>
<div class="section" id="reference-documentation">
<span id="id1"></span><h2>Reference documentation<a class="headerlink" href="#reference-documentation" title="Permalink to this headline">¶</a></h2>
<div class="section" id="enabling-global-or-module-level-functions">
<span id="luaunit-global-asserts"></span><h3>Enabling global or module-level functions<a class="headerlink" href="#enabling-global-or-module-level-functions" title="Permalink to this headline">¶</a></h3>
<p>Versions of LuaUnit before version 3.1 would export all assertions functions to the global namespace. A typical
lua test file would look like this:</p>
<div class="highlight-lua"><div class="highlight"><pre><span></span><span class="nb">require</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">luaunit&#39;</span><span class="p">)</span>

<span class="n">TestToto</span> <span class="o">=</span> <span class="p">{}</span> <span class="c1">--class</span>

    <span class="k">function</span> <span class="nf">TestToto</span><span class="p">:</span><span class="n">test1_withFailure</span><span class="p">()</span>
        <span class="kd">local</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">assertEquals</span><span class="p">(</span> <span class="n">a</span> <span class="p">,</span> <span class="mi">1</span> <span class="p">)</span>
        <span class="c1">-- will fail</span>
        <span class="n">assertEquals</span><span class="p">(</span> <span class="n">a</span> <span class="p">,</span> <span class="mi">2</span> <span class="p">)</span>
    <span class="k">end</span>

<span class="p">[</span><span class="o">...</span><span class="p">]</span>
</pre></div>
</div>
<p>However, this is an obsolete practice in Lua. It is now recommended to keep all functions inside the module. Starting
from version 3.1 LuaUnit follows this practice and the code should be adapted to look like this:</p>
<div class="highlight-lua"><div class="highlight"><pre><span></span><span class="c1">-- the imported module must be stored</span>
<span class="n">luaunit</span> <span class="o">=</span> <span class="nb">require</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">luaunit&#39;</span><span class="p">)</span>

<span class="n">TestToto</span> <span class="o">=</span> <span class="p">{}</span> <span class="c1">--class</span>

    <span class="k">function</span> <span class="nf">TestToto</span><span class="p">:</span><span class="n">test1_withFailure</span><span class="p">()</span>
        <span class="kd">local</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">luaunit</span><span class="p">.</span><span class="n">assertEquals</span><span class="p">(</span> <span class="n">a</span> <span class="p">,</span> <span class="mi">1</span> <span class="p">)</span>
        <span class="c1">-- will fail</span>
        <span class="n">luaunit</span><span class="p">.</span><span class="n">assertEquals</span><span class="p">(</span> <span class="n">a</span> <span class="p">,</span> <span class="mi">2</span> <span class="p">)</span>
    <span class="k">end</span>

<span class="p">[</span><span class="o">...</span><span class="p">]</span>
</pre></div>
</div>
<p>If you prefer the old way, LuaUnit can continue to export assertions functions if you set the following
global variable <strong>prior</strong> to importing LuaUnit:</p>
<div class="highlight-lua"><div class="highlight"><pre><span></span><span class="c1">-- this works</span>
<span class="n">EXPORT_ASSERT_TO_GLOBALS</span> <span class="o">=</span> <span class="kc">true</span>
<span class="nb">require</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">luaunit&#39;</span><span class="p">)</span>

<span class="n">TestToto</span> <span class="o">=</span> <span class="p">{}</span> <span class="c1">--class</span>

    <span class="k">function</span> <span class="nf">TestToto</span><span class="p">:</span><span class="n">test1_withFailure</span><span class="p">()</span>
        <span class="kd">local</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">assertEquals</span><span class="p">(</span> <span class="n">a</span> <span class="p">,</span> <span class="mi">1</span> <span class="p">)</span>
        <span class="c1">-- will fail</span>
        <span class="n">assertEquals</span><span class="p">(</span> <span class="n">a</span> <span class="p">,</span> <span class="mi">2</span> <span class="p">)</span>
    <span class="k">end</span>

<span class="p">[</span><span class="o">...</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="luaunit-run-function">
<span id="luaunit-run"></span><h3>LuaUnit.run() function<a class="headerlink" href="#luaunit-run-function" title="Permalink to this headline">¶</a></h3>
<p><strong>Return value</strong></p>
<p>Normally, you should run your test suite with the following line:</p>
<div class="highlight-lua"><div class="highlight"><pre><span></span><span class="nb">os.exit</span><span class="p">(</span><span class="n">luaunit</span><span class="p">.</span><span class="n">LuaUnit</span><span class="p">.</span><span class="n">run</span><span class="p">())</span>
</pre></div>
</div>
<p>The <em>run()</em> function returns the number of failures of the test suite. This is
good for an exit code, 0 meaning success.</p>
<p><strong>Arguments</strong></p>
<p>If no arguments are supplied, it parses the command-line arguments of the script
and interpret them. If arguments are supplied to the function, they are parsed
instead of the command-line. It uses the same syntax.</p>
<p>Example:</p>
<div class="highlight-lua"><div class="highlight"><pre><span></span><span class="c1">-- execute tests matching the &#39;withXY&#39; pattern</span>
<span class="nb">os.exit</span><span class="p">(</span><span class="n">luaunit</span><span class="p">.</span><span class="n">LuaUnit</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">--pattern&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">withXY&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p><strong>Choice of tests</strong></p>
<p>If test names were supplied, only those
tests are executed. When test names are supplied, they don&#8217;t have
to start with <em>test</em>, they are run anyway.</p>
<p>If no test names were supplied, a general test collection process starts
under the following rules:</p>
<ul>
<li><p class="first">all variable starting with <em>test</em> or <em>Test</em> are scanned.</p>
</li>
<li><p class="first">if the variable is a function it is collected for testing</p>
</li>
<li><p class="first">if the variable is a table:</p>
<blockquote>
<div><ul class="simple">
<li>all keys starting with <em>test</em> or <em>Test</em> are collected (provided that they are functions)</li>
<li>keys with name <em>setUp</em> and <em>tearDown</em> are also collected</li>
</ul>
</div></blockquote>
</li>
</ul>
<p>If one or more pattern were supplied, the test are then filtered according the
pattern(s). Only the test that match the pattern(s) are actually executed.</p>
<p><strong>setup and teardown</strong></p>
<p>The function <em>setUp()</em> is executed before each test if it exists in the table.
The function <em>tearDown()</em> is executed after every test if it exists in the table.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><em>tearDown()</em> is always executed if it exists, even if there was a failure in the test or in the <em>setUp()</em> function.
Failures in <em>setUp()</em> or <em>tearDown()</em> are considered as a general test failures.</p>
</div>
</div>
<div class="section" id="luaunit-runsuite-function">
<h3>LuaUnit.runSuite() function<a class="headerlink" href="#luaunit-runsuite-function" title="Permalink to this headline">¶</a></h3>
<p>If you want to keep the flexibility of the command-line parsing, but want to force
some parameters, like the output format, you must use a slightly different syntax:</p>
<div class="highlight-lua"><div class="highlight"><pre><span></span><span class="n">lu</span> <span class="o">=</span> <span class="n">luaunit</span><span class="p">.</span><span class="n">LuaUnit</span><span class="p">.</span><span class="n">new</span><span class="p">()</span>
<span class="n">lu</span><span class="p">:</span><span class="n">setOutputType</span><span class="p">(</span><span class="s2">&quot;</span><span class="s">tap&quot;</span><span class="p">)</span>
<span class="nb">os.exit</span><span class="p">(</span> <span class="n">lu</span><span class="p">:</span><span class="n">runSuite</span><span class="p">()</span> <span class="p">)</span>
</pre></div>
</div>
<p><em>runSuite()</em> behaves like <em>run()</em> except that it must be started
with a LuaUnit instance as first argument, and it will use the LuaUnit
instance settings.</p>
</div>
<div class="section" id="command-line-options">
<span id="command-line"></span><h3>Command-line options<a class="headerlink" href="#command-line-options" title="Permalink to this headline">¶</a></h3>
<p>Usage: lua &lt;your_test_suite.lua&gt; [options] [testname1 [testname2]</p>
<p><strong>Test names</strong></p>
<p>When no test names are supplied, all tests are collected.</p>
<p>The syntax for supplying test names can be either: name of the function, name of the table
or name of the table + &#8216;.&#8217; + name of the function. Only the supplied tests will be executed.</p>
<p><strong>Selecting output format</strong></p>
<p>Choose the output format with the syntax <code class="docutils literal"><span class="pre">-o</span> <span class="pre">FORMAT</span></code> or <code class="docutils literal"><span class="pre">--output</span> <span class="pre">FORMAT</span></code>.</p>
<p>Formats available:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">text</span></code>: the default output format of LuaUnit</li>
<li><code class="docutils literal"><span class="pre">nil</span></code>: no output at all</li>
<li><code class="docutils literal"><span class="pre">tap</span></code>: output compatible with the <a class="reference external" href="http://testanything.org/">Test Anything Protocol</a></li>
<li><code class="docutils literal"><span class="pre">junit</span></code>: output compatible with the <em>JUnit xml</em> format (used by many CI platforms)</li>
</ul>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">In the JUnit format, a destination filename must be supplied with <code class="docutils literal"><span class="pre">--name</span></code> or <code class="docutils literal"><span class="pre">-n</span></code></p>
</div>
<p><strong>Destination filename</strong></p>
<p>When using the JUnit format, the test suites writes an XML file with the test results. The
file name is mandatory and must be supplied with: <code class="docutils literal"><span class="pre">--name</span> <span class="pre">FILENAME</span></code> or <code class="docutils literal"><span class="pre">-n</span> <span class="pre">FILENAME</span></code></p>
<p><strong>Selecting tests with patterns</strong></p>
<p>You select a subset of tests by specifying one or more filter patterns,
with <code class="docutils literal"><span class="pre">-p</span> <span class="pre">PATTERN</span></code> or <code class="docutils literal"><span class="pre">--pattern</span> <span class="pre">PATTERN</span></code>.</p>
<p>The pattern is looked for on the full test name <em>TestTable.testMethod</em> . Only the tests that
actually match the pattern are selected. When specifying more than one pattern,
they are tried one by one until the name matches (OR combination).</p>
<p>Make sure you esape magic chars like <code class="docutils literal"><span class="pre">+?-*</span></code> with <code class="docutils literal"><span class="pre">%</span></code> .</p>
<p><strong>Other Options:</strong></p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">-h</span></code>, <code class="docutils literal"><span class="pre">--help</span></code>: display the command-line help.</li>
<li><code class="docutils literal"><span class="pre">--version</span></code>: display the version information</li>
<li><code class="docutils literal"><span class="pre">-v</span></code>, <code class="docutils literal"><span class="pre">--verbose</span></code>: Increase the output verbosity. The exact effect depends on the output format. May be specified multiple times.</li>
<li><code class="docutils literal"><span class="pre">-q</span></code>, <code class="docutils literal"><span class="pre">--quiet</span></code>:  Set verbosity to minimum. The exact effect depends on the output format.</li>
</ul>
</div>
<div class="section" id="assertions-functions">
<span id="assertions-label"></span><h3>Assertions functions<a class="headerlink" href="#assertions-functions" title="Permalink to this headline">¶</a></h3>
<p>You will now find the list of all assertion functions. For all functions, When an assertion fails, the failure
message tries to be as informative as possible, by displaying the expectation and value that caused the failure.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">see :More on table printing: to know more about tables.</p>
</div>
<div class="section" id="equality-assertions">
<span id="assert-equality"></span><h4>Equality assertions<a class="headerlink" href="#equality-assertions" title="Permalink to this headline">¶</a></h4>
<p>All equality assertions functions take two arguments, in the order
<em>actual value</em> then <em>expected value</em>. Some people are more familiar
with the order <em>expected value</em> then <em>actual value</em>. It is possible to configure
LuaUnit to use the opposite order for all equality assertions, by setting up a module
variable:</p>
<div class="highlight-lua"><div class="highlight"><pre><span></span><span class="n">luaunit</span><span class="p">.</span><span class="n">ORDER_ACTUAL_EXPECTED</span><span class="o">=</span><span class="kc">false</span>
</pre></div>
</div>
<p>The order only matters for the message that is displayed in case of failures. It does
not influence the test itself.</p>
<dl class="function">
<dt id="assertEquals">
<code class="descname">assertEquals</code><span class="sig-paren">(</span><em>actual</em>, <em>expected</em><span class="sig-paren">)</span><a class="headerlink" href="#assertEquals" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>Alias</strong>: <em>assert_equals()</em></p>
<p>Assert that two values are equal.</p>
<p>For tables, the comparison is a deep comparison :</p>
<ul class="simple">
<li>number of elements must be the same</li>
<li>tables must contain the same keys</li>
<li>each key must contain the same values. The values
are also compared recursively with deep comparison.</li>
</ul>
<p>LuaUnit provides other table-related assertions, see <a class="reference internal" href="#assert-table"><span>Table assertions</span></a></p>
</dd></dl>

<dl class="function">
<dt id="assertNotEquals">
<code class="descname">assertNotEquals</code><span class="sig-paren">(</span><em>actual</em>, <em>expected</em><span class="sig-paren">)</span><a class="headerlink" href="#assertNotEquals" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>Alias</strong>: <em>assert_not_equals()</em></p>
<p>Assert that two values are different. The assertion
fails if the two values are identical.</p>
<p>It also uses table deep comparison.</p>
</dd></dl>

<dl class="function">
<dt id="assertAlmostEquals">
<code class="descname">assertAlmostEquals</code><span class="sig-paren">(</span><em>actual</em>, <em>expected</em>, <em>margin</em><span class="sig-paren">)</span><a class="headerlink" href="#assertAlmostEquals" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>Alias</strong>: <em>assert_almost_equals()</em></p>
<p>Assert that two floating point numbers are almost equal.</p>
<p>When comparing floating point numbers, strict equality does not work.
Computer arithmetic is so that an operation that mathematically
yields 1.00000000 might yield 0.999999999999 in lua . That&#8217;s why you
need an <em>almost equals</em> comparison, where you specify the error margin.</p>
</dd></dl>

<dl class="function">
<dt id="assertNotAlmostEquals">
<code class="descname">assertNotAlmostEquals</code><span class="sig-paren">(</span><em>actual</em>, <em>expected</em>, <em>margin</em><span class="sig-paren">)</span><a class="headerlink" href="#assertNotAlmostEquals" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>Alias</strong>: <em>assert_not_almost_equals()</em></p>
<p>Assert that two floating point numbers are not almost equal.</p>
</dd></dl>

</div>
<div class="section" id="value-assertions">
<span id="assert-value"></span><h4>Value assertions<a class="headerlink" href="#value-assertions" title="Permalink to this headline">¶</a></h4>
<dl class="function">
<dt id="assertTrue">
<code class="descname">assertTrue</code><span class="sig-paren">(</span><em>value</em><span class="sig-paren">)</span><a class="headerlink" href="#assertTrue" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>Alias</strong>: <em>assert_true()</em></p>
<p>Assert that a given value compares to true. Lua coercion rules are applied
so that values like <code class="docutils literal"><span class="pre">0</span></code>, <code class="docutils literal"><span class="pre">&quot;&quot;</span></code>, <code class="docutils literal"><span class="pre">1.17</span></code> all compare to <em>true</em>.</p>
</dd></dl>

<dl class="function">
<dt id="assertFalse">
<code class="descname">assertFalse</code><span class="sig-paren">(</span><em>value</em><span class="sig-paren">)</span><a class="headerlink" href="#assertFalse" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>Alias</strong>: <em>assert_false()</em></p>
<p>Assert that a given value compares to false. Lua coercion rules are applied
so that only <em>nil</em> and <em>false</em> all compare to <em>false</em>.</p>
</dd></dl>

<dl class="function">
<dt id="assertNil">
<code class="descname">assertNil</code><span class="sig-paren">(</span><em>value</em><span class="sig-paren">)</span><a class="headerlink" href="#assertNil" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>Aliases</strong>: <em>assert_nil()</em>, <em>assertIsNil()</em>, <em>assert_is_nil()</em></p>
<p>Assert that a given value is <em>nil</em> .</p>
</dd></dl>

<dl class="function">
<dt id="assertNotNil">
<code class="descname">assertNotNil</code><span class="sig-paren">(</span><em>value</em><span class="sig-paren">)</span><a class="headerlink" href="#assertNotNil" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>Aliases</strong>: <em>assert_not_nil()</em>, <em>assertNotIsNil()</em>, <em>assert_not_is_nil()</em></p>
<p>Assert that a given value is not <em>nil</em> . Lua coercion rules are applied
so that values like <code class="docutils literal"><span class="pre">0</span></code>, <code class="docutils literal"><span class="pre">&quot;&quot;</span></code>, <code class="docutils literal"><span class="pre">false</span></code> all validate the assertion.</p>
</dd></dl>

<dl class="function">
<dt id="assertIs">
<code class="descname">assertIs</code><span class="sig-paren">(</span><em>actual</em>, <em>expected</em><span class="sig-paren">)</span><a class="headerlink" href="#assertIs" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>Alias</strong>: <em>assert_is()</em></p>
<p>Assert that two variables are identical. For string, numbers, boolean and for nil,
this gives the same result as <a class="reference internal" href="#assertEquals" title="assertEquals"><code class="xref py py-func docutils literal"><span class="pre">assertEquals()</span></code></a> . For the other types, identity
means that the two variables refer to the same object.</p>
<p><strong>Example :</strong></p>
</dd></dl>

<div class="highlight-lua"><div class="highlight"><pre><span></span><span class="n">s1</span><span class="o">=</span><span class="s1">&#39;</span><span class="s">toto&#39;</span>
<span class="n">s2</span><span class="o">=</span><span class="s1">&#39;</span><span class="s">to&#39;</span><span class="o">..</span><span class="s1">&#39;</span><span class="s">to&#39;</span>
<span class="n">t1</span><span class="o">=</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">}</span>
<span class="n">t2</span><span class="o">=</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">}</span>

<span class="n">luaunit</span><span class="p">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">s1</span><span class="p">,</span><span class="n">s1</span><span class="p">)</span> <span class="c1">-- ok</span>
<span class="n">luaunit</span><span class="p">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">s1</span><span class="p">,</span><span class="n">s2</span><span class="p">)</span> <span class="c1">-- ok</span>
<span class="n">luaunit</span><span class="p">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">t1</span><span class="p">,</span><span class="n">t1</span><span class="p">)</span> <span class="c1">-- ok</span>
<span class="n">luaunit</span><span class="p">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">t1</span><span class="p">,</span><span class="n">t2</span><span class="p">)</span> <span class="c1">-- fail</span>
</pre></div>
</div>
<dl class="function">
<dt id="assertNotIs">
<code class="descname">assertNotIs</code><span class="sig-paren">(</span><em>actual</em>, <em>expected</em><span class="sig-paren">)</span><a class="headerlink" href="#assertNotIs" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>Alias</strong>: <em>assert_not_is()</em></p>
<p>Assert that two variables are not identical, in the sense that they do not
refer to the same value. See <a class="reference internal" href="#assertIs" title="assertIs"><code class="xref py py-func docutils literal"><span class="pre">assertIs()</span></code></a> for more details.</p>
</dd></dl>

</div>
<div class="section" id="string-assertions">
<span id="assert-string"></span><h4>String assertions<a class="headerlink" href="#string-assertions" title="Permalink to this headline">¶</a></h4>
<p>Assertions related to string and patterns.</p>
<dl class="function">
<dt id="assertStrContains">
<code class="descname">assertStrContains</code><span class="sig-paren">(</span><em>str</em>, <em>sub</em><span class="optional">[</span>, <em>useRe</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#assertStrContains" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>Alias</strong>: <em>assert_str_contains()</em></p>
<p>Assert that a string contains the given substring or pattern.</p>
<p>By default, substring is searched in the string. If <em>useRe</em>
is provided and is true, <em>sub</em> is treated as a pattern which
is searched inside the string <em>str</em> .</p>
</dd></dl>

<dl class="function">
<dt id="assertStrIContains">
<code class="descname">assertStrIContains</code><span class="sig-paren">(</span><em>str</em>, <em>sub</em><span class="sig-paren">)</span><a class="headerlink" href="#assertStrIContains" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>Alias</strong>: <em>assert_str_icontains()</em></p>
<p>Assert that a string contains the given substring, irrespective of the case.</p>
<p>Not that unlike <code class="xref py py-func docutils literal"><span class="pre">assertStrcontains()</span></code>, you can not search for a pattern.</p>
</dd></dl>

<dl class="function">
<dt id="assertNotStrContains">
<code class="descname">assertNotStrContains</code><span class="sig-paren">(</span><em>str</em>, <em>sub</em>, <em>useRe</em><span class="sig-paren">)</span><a class="headerlink" href="#assertNotStrContains" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>Alias</strong>: <em>assert_not_str_contains()</em></p>
<p>Assert that a string does not contain a given substring or pattern.</p>
<p>By default, substring is searched in the string. If <em>useRe</em>
is provided and is true, <em>sub</em> is treated as a pattern which
is searched inside the string <em>str</em> .</p>
</dd></dl>

<dl class="function">
<dt id="assertNotStrIContains">
<code class="descname">assertNotStrIContains</code><span class="sig-paren">(</span><em>str</em>, <em>sub</em><span class="sig-paren">)</span><a class="headerlink" href="#assertNotStrIContains" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>Alias</strong>: <em>assert_not_str_icontains()</em></p>
<p>Assert that a string does not contain the given substring, irrespective of the case.</p>
<p>Not that unlike <code class="xref py py-func docutils literal"><span class="pre">assertNotStrcontains()</span></code>, you can not search for a pattern.</p>
</dd></dl>

<dl class="function">
<dt id="assertStrMatches">
<code class="descname">assertStrMatches</code><span class="sig-paren">(</span><em>str</em>, <em>pattern</em><span class="optional">[</span>, <em>start</em><span class="optional">[</span>, <em>final</em><span class="optional">]</span><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#assertStrMatches" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>Alias</strong>: <em>assert_str_matches()</em></p>
<p>Assert that a string matches the full pattern <em>pattern</em>.</p>
<p>If <em>start</em> and <em>final</em> are not provided or are <em>nil</em>, the pattern must match the full string, from start to end. The
functions allows to specify the expected start and end position of the pattern in the string.</p>
</dd></dl>

</div>
<div class="section" id="error-assertions">
<span id="assert-error"></span><h4>Error assertions<a class="headerlink" href="#error-assertions" title="Permalink to this headline">¶</a></h4>
<p>Error related assertions, to verify error generation and error messages.</p>
<dl class="function">
<dt id="assertError">
<code class="descname">assertError</code><span class="sig-paren">(</span><em>func</em>, <em>...</em><span class="sig-paren">)</span><a class="headerlink" href="#assertError" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>Alias</strong>: <em>assert_error()</em></p>
<p>Assert that calling functions <em>func</em> with the arguments yields an error. If the
function does not yield an error, the assertion fails.</p>
<p>Note that the error message itself is not checked, which means that this function
does not distinguish between the legitimate error that you expect and another error
that might be triggered by mistake.</p>
<p>The next functions provide a better approach to error testing, by checking
explicitly the error message content.</p>
</dd></dl>

<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">When testing LuaUnit, switching from <em>assertError()</em> to  <em>assertErrorMsgEquals()</em>
revealed quite a few bugs!</p>
</div>
<dl class="function">
<dt id="assertErrorMsgEquals">
<code class="descname">assertErrorMsgEquals</code><span class="sig-paren">(</span><em>expectedMsg</em>, <em>func</em>, <em>...</em><span class="sig-paren">)</span><a class="headerlink" href="#assertErrorMsgEquals" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>Alias</strong>: <em>assert_error_msg_equals()</em></p>
<p>Assert that calling function <em>func</em> will generate exactly the given error message. If the
function does not yield an error, or if the error message is not identical, the assertion fails.</p>
<p>Be careful when using this function that error messages usually contain the file name and
line number information of where the error was generated. This is usually inconvenient. To
ignore the filename and line number information, you can either use a pattern with <a class="reference internal" href="#assertErrorMsgMatches" title="assertErrorMsgMatches"><code class="xref py py-func docutils literal"><span class="pre">assertErrorMsgMatches()</span></code></a>
or simply check for the message containt with <a class="reference internal" href="#assertErrorMsgContains" title="assertErrorMsgContains"><code class="xref py py-func docutils literal"><span class="pre">assertErrorMsgContains()</span></code></a> .</p>
</dd></dl>

<dl class="function">
<dt id="assertErrorMsgContains">
<code class="descname">assertErrorMsgContains</code><span class="sig-paren">(</span><em>partialMsg</em>, <em>func</em>, <em>...</em><span class="sig-paren">)</span><a class="headerlink" href="#assertErrorMsgContains" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>Alias</strong>: <em>assert_error_msg_contains()</em></p>
<p>Assert that calling function <em>func</em> will generate an error message containing <em>partialMsg</em> . If the
function does not yield an error, or if the expected message is not contained in the error message, the
assertion fails.</p>
</dd></dl>

<dl class="function">
<dt id="assertErrorMsgMatches">
<code class="descname">assertErrorMsgMatches</code><span class="sig-paren">(</span><em>expectedPattern</em>, <em>func</em>, <em>...</em><span class="sig-paren">)</span><a class="headerlink" href="#assertErrorMsgMatches" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>Alias</strong>: <em>assert_error_msg_matches()</em></p>
<p>Assert that calling function <em>func</em> will generate an error message matching <em>expectedPattern</em> . If the
function does not yield an error, or if the error message does not match the provided patternm the
assertion fails.</p>
<p>Note that matching is done from the start to the end of the error message. Be sure to escape magic all magic
characters with <code class="docutils literal"><span class="pre">%</span></code> (like <code class="docutils literal"><span class="pre">-+.?*</span></code>) .</p>
</dd></dl>

</div>
<div class="section" id="type-assertions">
<span id="assert-type"></span><h4>Type assertions<a class="headerlink" href="#type-assertions" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div>The following functions all perform type checking on their argument. If the
received value is not of the right type, the failure message will contain
the expected type, the received type and the received value to help you
identify better the problem.</div></blockquote>
<dl class="function">
<dt id="assertIsNumber">
<code class="descname">assertIsNumber</code><span class="sig-paren">(</span><em>value</em><span class="sig-paren">)</span><a class="headerlink" href="#assertIsNumber" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>Aliases</strong>: <em>assertNumber()</em>, <em>assert_is_number()</em>, <em>assert_number()</em></p>
<p>Assert that the argument is a number (integer or float)</p>
</dd></dl>

<dl class="function">
<dt id="assertIsString">
<code class="descname">assertIsString</code><span class="sig-paren">(</span><em>value</em><span class="sig-paren">)</span><a class="headerlink" href="#assertIsString" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>Aliases</strong>: <em>assertString()</em>, <em>assert_is_string()</em>, <em>assert_string()</em></p>
<p>Assert that the argument is a string.</p>
</dd></dl>

<dl class="function">
<dt id="assertIsTable">
<code class="descname">assertIsTable</code><span class="sig-paren">(</span><em>value</em><span class="sig-paren">)</span><a class="headerlink" href="#assertIsTable" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>Aliases</strong>: <em>assertTable()</em>, <em>assert_is_table()</em>, <em>assert_table()</em></p>
<p>Assert that the argument is a table.</p>
</dd></dl>

<dl class="function">
<dt id="assertIsBoolean">
<code class="descname">assertIsBoolean</code><span class="sig-paren">(</span><em>value</em><span class="sig-paren">)</span><a class="headerlink" href="#assertIsBoolean" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>Aliases</strong>: <em>assertBoolean()</em>, <em>assert_is_boolean()</em>, <em>assert_boolean()</em></p>
<p>Assert that the argument is a boolean.</p>
</dd></dl>

<dl class="function">
<dt id="assertIsNil">
<code class="descname">assertIsNil</code><span class="sig-paren">(</span><em>value</em><span class="sig-paren">)</span><a class="headerlink" href="#assertIsNil" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>Aliases</strong>: <em>assertNil()</em>, <em>assert_is_nil()</em>, <em>assert_nil()</em></p>
<p>Assert that the argument is a nil.</p>
</dd></dl>

<dl class="function">
<dt id="assertIsFunction">
<code class="descname">assertIsFunction</code><span class="sig-paren">(</span><em>value</em><span class="sig-paren">)</span><a class="headerlink" href="#assertIsFunction" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>Aliases</strong>: <em>assertFunction()</em>, <em>assert_is_function()</em>, <em>assert_function()</em></p>
<p>Assert that the argument is a function.</p>
</dd></dl>

<dl class="function">
<dt id="assertIsUserdata">
<code class="descname">assertIsUserdata</code><span class="sig-paren">(</span><em>value</em><span class="sig-paren">)</span><a class="headerlink" href="#assertIsUserdata" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>Aliases</strong>: <em>assertUserdata()</em>, <em>assert_is_userdata()</em>, <em>assert_userdata()</em></p>
<p>Assert that the argument is a userdata.</p>
</dd></dl>

<dl class="function">
<dt id="assertIsCoroutine">
<code class="descname">assertIsCoroutine</code><span class="sig-paren">(</span><em>value</em><span class="sig-paren">)</span><a class="headerlink" href="#assertIsCoroutine" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>Aliases</strong>: <em>assertCoroutine()</em>, <em>assert_is_coroutine()</em>, <em>assert_coroutine()</em>, <em>assertIsThread()</em>, <em>assertThread()</em>, <em>assert_is_thread()</em>, <em>assert_thread()</em></p>
<p>Assert that the argument is a coroutine (an object with type <em>thread</em> ).</p>
</dd></dl>

</div>
<div class="section" id="table-assertions">
<span id="assert-table"></span><h4>Table assertions<a class="headerlink" href="#table-assertions" title="Permalink to this headline">¶</a></h4>
<dl class="function">
<dt id="assertItemsEquals">
<code class="descname">assertItemsEquals</code><span class="sig-paren">(</span><em>actual</em>, <em>expected</em><span class="sig-paren">)</span><a class="headerlink" href="#assertItemsEquals" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>Alias</strong>: <em>assert_items_equals()</em></p>
<p>Assert that two tables contain the same items, irrespective of their keys.</p>
<p>This function is practical for example if you want to compare two lists but
where items are not in the same order:</p>
</dd></dl>

<div class="highlight-lua"><div class="highlight"><pre><span></span><span class="n">luaunit</span><span class="p">.</span><span class="n">assertItemsEquals</span><span class="p">(</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">},</span> <span class="p">{</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">}</span> <span class="p">)</span> <span class="c1">-- assertion succeeds</span>
</pre></div>
</div>
<blockquote>
<div>The comparison is not recursive on the items: if any of the items are tables,
they are compared using table equality (like as in <a class="reference internal" href="#assertEquals" title="assertEquals"><code class="xref py py-func docutils literal"><span class="pre">assertEquals()</span></code></a> ), where
the key matters.</div></blockquote>
<div class="highlight-lua"><div class="highlight"><pre><span></span><span class="n">luaunit</span><span class="p">.</span><span class="n">assertItemsEquals</span><span class="p">(</span> <span class="p">{</span><span class="mi">1</span><span class="p">,{</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">},</span><span class="mi">4</span><span class="p">},</span> <span class="p">{</span><span class="mi">4</span><span class="p">,{</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,},</span><span class="mi">1</span><span class="p">}</span> <span class="p">)</span> <span class="c1">-- assertion fails because {2,3} ~= {3,2}</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="developing-luaunit">
<span id="id2"></span><h2>Developing LuaUnit<a class="headerlink" href="#developing-luaunit" title="Permalink to this headline">¶</a></h2>
<div class="section" id="development-ecosystem">
<h3>Development ecosystem<a class="headerlink" href="#development-ecosystem" title="Permalink to this headline">¶</a></h3>
<p>LuaUnit is developed on <a class="reference external" href="https://github.com/bluebird75/luaunit">Github</a>.</p>
<p>Bugs or feature requests should be reported using <a class="reference external" href="https://github.com/bluebird75/luaunit/issues">GitHub issues</a>.</p>
<p>Usage and development may be discussed on <a class="reference external" href="http://lists.freehackers.org/list/luaunit%40freehackers.org/">LuaUnit mailing-list</a> . If you are using LuaUnit for your
project, please drop us an note.</p>
<p>It is released under the BSD license.</p>
<p>This documentation is available at <a class="reference external" href="http://luaunit.readthedocs.org/en/latest/">Read-the-docs</a>.</p>
</div>
<div class="section" id="contributing">
<h3>Contributing<a class="headerlink" href="#contributing" title="Permalink to this headline">¶</a></h3>
<p>You may contribute to LuaUnit by reporting bugs, fixing reported bugs or developing new features.</p>
<p>Some issues on github are marked with label <em>enhancement</em>. Feel free to pick up such tasks and implement them.</p>
<p>Changes should be proposed as <em>Pull Requests</em> on github.</p>
<div class="section" id="unit-tests">
<h4>Unit-tests<a class="headerlink" href="#unit-tests" title="Permalink to this headline">¶</a></h4>
<p>All proposed changes should pass all unit-tests and if needed, add more unit-tests to cover the bug or the new functionality. Usage is pretty simple:</p>
<div class="highlight-shell"><div class="highlight"><pre><span></span>$ lua run_unit_tests.lua
................................................................................
...............................
Ran <span class="m">111</span> tests in 0.120 seconds
OK
</pre></div>
</div>
</div>
<div class="section" id="functional-tests">
<h4>Functional tests<a class="headerlink" href="#functional-tests" title="Permalink to this headline">¶</a></h4>
<p>Functional tests also exist to validate LuaUnit. Their management is slightly more complicated.</p>
<p>The main goal of functional tests is to validate that LuaUnit output has not been altered. Since LuaUnit supports some standard compliant output (TAP, junitxml), this is very important (and it has been broken in the past)</p>
<p>Functional tests perform the following actions:</p>
<ul>
<li><p class="first">Run each of the 3 suites: example_with_luaunit.lua, test_with_xml.lua, run_unit_test.lua (LuaUnit&#8217;s internal test suite)</p>
</li>
<li><p class="first">Run every suite with all output format, all verbosity</p>
</li>
<li><p class="first">Validate the XML output with jenkins/hudson and junit schema</p>
</li>
<li><p class="first">Compare the results with the previous output ( archived in test/ref ), with some tricks to make the comparison possible :</p>
<blockquote>
<div><ul class="simple">
<li>adjustment of the file separator to use the same output on Windows and Unix</li>
<li>date and test duration is zeroed so that it does not impact the comparison</li>
<li>adjust the stack trace format which has changed between Lua 5.1, 5.2 and 5.3</li>
</ul>
</div></blockquote>
</li>
</ul>
<p>For functional tests to run, <em>diff</em> must be available on the command line. <em>xmllint</em> is needed to perform the xml validation but
this step is skipped if <em>xmllint</em> can not be found.</p>
<p>When functional tests work well, it looks like this:</p>
<div class="highlight-shell"><div class="highlight"><pre><span></span>$ lua run_functional_tests.lua
...............
Ran <span class="m">15</span> tests in 9.676 seconds
OK
</pre></div>
</div>
<p>When functional test fail, a diff of the comparison between the reference output and the current output is displayed (it can be quite
long). The list of faulty files is summed-up at the end.</p>
</div>
<div class="section" id="modifying-reference-files-for-functional-tests">
<h4>Modifying reference files for functional tests<a class="headerlink" href="#modifying-reference-files-for-functional-tests" title="Permalink to this headline">¶</a></h4>
<p>The script run_functional_tests.lua supports a &#8211;update option, with an optional argument.</p>
<ul>
<li><p class="first"><em>&#8211;update</em> without argument <strong>overwrites all reference output</strong> with the current output. Use only if you know what you are doing, this is usually a very bad idea!</p>
</li>
<li><p class="first">The following argument overwrite a specific subset of reference files, select the one that fits your change:</p>
<blockquote>
<div><ul class="simple">
<li>TestXml: XML output of test_with_xml</li>
<li>ExampleXml: XML output of example_with_luaunit</li>
<li>ExampleTap: TAP output of example_with_luaunit</li>
<li>ExampleText: text output of example_with_luaunit</li>
<li>ExampleNil: nil output of example_with_luaunit</li>
<li>UnitXml: XML output of run_unit_tests</li>
<li>UnitTap: TAP output of run_unit_tests</li>
<li>UnitText: text output of run_unit_tests</li>
</ul>
</div></blockquote>
</li>
</ul>
<p>For example to record a change in the unit-tests:</p>
<div class="highlight-shell"><div class="highlight"><pre><span></span>$ lua run_functional_tests.lua --update UnitXml UnitTap UnitText
&gt;&gt;&gt;&gt;&gt;&gt;&gt; Generating test/ref/unitTestsXmlDefault.txt
&gt;&gt;&gt;&gt;&gt;&gt;&gt; Generating test/ref/unitTestsXmlQuiet.txt
&gt;&gt;&gt;&gt;&gt;&gt;&gt; Generating test/ref/unitTestsXmlVerbose.txt
&gt;&gt;&gt;&gt;&gt;&gt;&gt; Generating test/ref/unitTestsTapDefault.txt
&gt;&gt;&gt;&gt;&gt;&gt;&gt; Generating test/ref/unitTestsTapQuiet.txt
&gt;&gt;&gt;&gt;&gt;&gt;&gt; Generating test/ref/unitTestsTapVerbose.txt
&gt;&gt;&gt;&gt;&gt;&gt;&gt; Generating test/ref/unitTestsTextDefault.txt
&gt;&gt;&gt;&gt;&gt;&gt;&gt; Generating test/ref/unitTestsTextQuiet.txt
&gt;&gt;&gt;&gt;&gt;&gt;&gt; Generating test/ref/unitTestsTextVerbose.txt
$
</pre></div>
</div>
<p>You can then commit the new files into git.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>how to commit updated reference outputs</p>
<p class="last">When committing those changes into git, please use if possible an
intelligent git committing tool to commit only the interesting changes.
With SourceTree for example, in case of XML changes, I can select only the
lines relevant to the change and avoid committing all the updates to test
duration and test datestamp.</p>
</div>
</div>
<div class="section" id="typical-failures-for-functional-tests">
<h4>Typical failures for functional tests<a class="headerlink" href="#typical-failures-for-functional-tests" title="Permalink to this headline">¶</a></h4>
<p>Functional tests may start failing when:</p>
<ol class="arabic simple">
<li>Adding a new unit-test</li>
<li>Increasing LuaUnit version</li>
<li>Improving or breaking LuaUnit output</li>
</ol>
<p><strong>Case 1: adding a new unit-test</strong></p>
<p>Because functional tests use LuaUnit self tests to verify the output, the output gets broken each time
a new unit-test is added. This is kind of stupid and should be improved but until it happens, you have to deal with it.</p>
<p>When it happens, functional tests generate tons of diff output, where the main change is the number of tests executed. Please
carefully verify that this is the only change. If so, fix it with:</p>
<div class="highlight-shell"><div class="highlight"><pre><span></span>$ lua run_functional_tests.lua --update UnitXml UnitTap UnitText
&gt;&gt;&gt;&gt;&gt;&gt;&gt; Generating test/ref/unitTestsXmlDefault.txt
&gt;&gt;&gt;&gt;&gt;&gt;&gt; Generating test/ref/unitTestsXmlQuiet.txt
&gt;&gt;&gt;&gt;&gt;&gt;&gt; Generating test/ref/unitTestsXmlVerbose.txt
&gt;&gt;&gt;&gt;&gt;&gt;&gt; Generating test/ref/unitTestsTapDefault.txt
&gt;&gt;&gt;&gt;&gt;&gt;&gt; Generating test/ref/unitTestsTapQuiet.txt
&gt;&gt;&gt;&gt;&gt;&gt;&gt; Generating test/ref/unitTestsTapVerbose.txt
&gt;&gt;&gt;&gt;&gt;&gt;&gt; Generating test/ref/unitTestsTextDefault.txt
&gt;&gt;&gt;&gt;&gt;&gt;&gt; Generating test/ref/unitTestsTextQuiet.txt
&gt;&gt;&gt;&gt;&gt;&gt;&gt; Generating test/ref/unitTestsTextVerbose.txt
$
</pre></div>
</div>
<p>Then commit the updates files.</p>
</div>
</div>
</div>
</div>
<div class="section" id="annexes">
<h1>Annexes<a class="headerlink" href="#annexes" title="Permalink to this headline">¶</a></h1>
<div class="section" id="annex-a-more-on-table-printing">
<h2>Annex A: More on table printing<a class="headerlink" href="#annex-a-more-on-table-printing" title="Permalink to this headline">¶</a></h2>
<p>When asserting tables equality, by default, the table content is printed in case of failures. LuaUnit tries to print
tables in a readable format. It is
possible to always display the table id along with the content, by setting a module parameter PRINT_TABLE_REF_IN_ERROR_MSG . This
helps identifying tables:</p>
<div class="highlight-lua"><div class="highlight"><pre><span></span><span class="kd">local</span> <span class="n">t1</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">}</span>
<span class="c1">-- normally, t1 is dispalyed as: &quot;{1,2,3}&quot;</span>

<span class="c1">-- if setting this:</span>
<span class="n">luaunit</span><span class="p">.</span><span class="n">PRINT_TABLE_REF_IN_ERROR_MSG</span> <span class="o">=</span> <span class="kc">true</span>

<span class="c1">-- display of table t1 becomes: &quot;&lt;table: 0x29ab56&gt; {1,2,3}&quot;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>table loops</p>
<p class="last">When displaying table content, it is possible to encounter loops, if for example two table references eachother. In such
cases, LuaUnit display the full table content once, along with the table id, and displays only the table id for the looping
reference.</p>
</div>
<p><strong>Example:</strong> displaying a table with reference loop</p>
<div class="highlight-lua"><div class="highlight"><pre><span></span><span class="kd">local</span> <span class="n">t1</span> <span class="o">=</span> <span class="p">{}</span>
<span class="kd">local</span> <span class="n">t2</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">t1</span><span class="p">.</span><span class="n">t2</span> <span class="o">=</span> <span class="n">t2</span>
<span class="n">t1</span><span class="p">.</span><span class="n">a</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">}</span>
<span class="n">t2</span><span class="p">.</span><span class="n">t1</span> <span class="o">=</span> <span class="n">t1</span>

<span class="c1">-- when displaying table t1:</span>
<span class="c1">--   table t1 inside t2 is only displayed by its id because t1 is already being displayed</span>
<span class="c1">--   table t2 is displayed along with its id because it is part of a loop.</span>
<span class="c1">-- t1: &quot;&lt;table: 0x29ab56&gt; { a={1,2,3}, t2=&lt;table: 0x27ab23&gt; {t1=&lt;table: 0x29ab56&gt;} }&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="index-and-search-page">
<h2>Index and Search page<a class="headerlink" href="#index-and-search-page" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><a class="reference internal" href="genindex.html"><span>Index</span></a></li>
<li><a class="reference internal" href="search.html"><span>Search Page</span></a></li>
</ul>
</div>
</div>


           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2014, Philippe Fremy.
      
        <span class="commit">
          Revision <code>d7a09f0f</code>.
        </span>
      

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> Read the Docs</span>
      v: latest
      <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      <dl>
        <dt>Versions</dt>
        
          <dd><a href="/en/latest/">latest</a></dd>
        
          <dd><a href="/en/stable/">stable</a></dd>
        
          <dd><a href="/en/luaunit_v3_1/">luaunit_v3_1</a></dd>
        
      </dl>
      <dl>
        <dt>Downloads</dt>
        
          <dd><a href="//readthedocs.org/projects/luaunit/downloads/pdf/latest/">pdf</a></dd>
        
          <dd><a href="//readthedocs.org/projects/luaunit/downloads/htmlzip/latest/">htmlzip</a></dd>
        
          <dd><a href="//readthedocs.org/projects/luaunit/downloads/epub/latest/">epub</a></dd>
        
      </dl>
      <dl>
        <dt>On Read the Docs</dt>
          <dd>
            <a href="//readthedocs.org/projects/luaunit/?fromdocs=luaunit">Project Home</a>
          </dd>
          <dd>
            <a href="//readthedocs.org/builds/luaunit/?fromdocs=luaunit">Builds</a>
          </dd>
      </dl>
      <hr/>
      Free document hosting provided by <a href="http://www.readthedocs.org">Read the Docs</a>.

    </div>
  </div>



  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'1.6',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="https://media.readthedocs.org/javascript/jquery/jquery-2.0.3.min.js"></script>
      <script type="text/javascript" src="https://media.readthedocs.org/javascript/jquery/jquery-migrate-1.2.1.min.js"></script>
      <script type="text/javascript" src="https://media.readthedocs.org/javascript/underscore.js"></script>
      <script type="text/javascript" src="https://media.readthedocs.org/javascript/doctools.js"></script>
      <script type="text/javascript" src="https://media.readthedocs.org/javascript/readthedocs-doc-embed.js"></script>

  

  
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>